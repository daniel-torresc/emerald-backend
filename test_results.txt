============================= test session starts ==============================
platform darwin -- Python 3.13.1, pytest-8.4.2, pluggy-1.6.0 -- /Users/danieltorres/Documents/emerald/emerald-backend/.venv/bin/python3
cachedir: .pytest_cache
rootdir: /Users/danieltorres/Documents/emerald/emerald-backend
configfile: pyproject.toml
plugins: asyncio-1.2.0, anyio-4.11.0, cov-7.0.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 334 items

tests/e2e/test_collaboration_workflow.py::test_account_sharing_collaboration_workflow FAILED [  0%]
tests/e2e/test_collaboration_workflow.py::test_permission_downgrade_workflow FAILED [  0%]
tests/e2e/test_collaboration_workflow.py::test_shared_account_transaction_visibility FAILED [  0%]
tests/e2e/test_collaboration_workflow.py::test_share_list_visibility FAILED [  1%]
tests/e2e/test_collaboration_workflow.py::test_cascading_share_revocation FAILED [  1%]
tests/e2e/test_user_journey.py::test_complete_user_journey FAILED        [  1%]
tests/e2e/test_user_journey.py::test_new_user_creates_multiple_accounts_and_transactions FAILED [  2%]
tests/e2e/test_user_journey.py::test_user_deactivation_workflow PASSED   [  2%]
tests/e2e/test_user_journey.py::test_transaction_tag_management_workflow FAILED [  2%]
tests/e2e/test_user_journey.py::test_transaction_split_and_join_workflow FAILED [  2%]
tests/e2e/test_user_journey.py::test_account_lifecycle_workflow PASSED   [  3%]
tests/integration/test_account_routes.py::TestAccountRoutes::test_create_account_success PASSED [  3%]
tests/integration/test_account_routes.py::TestAccountRoutes::test_create_account_negative_balance FAILED [  3%]
tests/integration/test_account_routes.py::TestAccountRoutes::test_create_account_duplicate_name PASSED [  4%]
tests/integration/test_account_routes.py::TestAccountRoutes::test_create_account_invalid_currency PASSED [  4%]
tests/integration/test_account_routes.py::TestAccountRoutes::test_create_account_unauthenticated PASSED [  4%]
tests/integration/test_account_routes.py::TestAccountRoutes::test_list_accounts_empty PASSED [  5%]
tests/integration/test_account_routes.py::TestAccountRoutes::test_list_accounts_multiple PASSED [  5%]
tests/integration/test_account_routes.py::TestAccountRoutes::test_list_accounts_filter_by_type PASSED [  5%]
tests/integration/test_account_routes.py::TestAccountRoutes::test_list_accounts_filter_by_active PASSED [  5%]
tests/integration/test_account_routes.py::TestAccountRoutes::test_list_accounts_pagination FAILED [  6%]
tests/integration/test_account_routes.py::TestAccountRoutes::test_get_account_success PASSED [  6%]
tests/integration/test_account_routes.py::TestAccountRoutes::test_get_account_not_found PASSED [  6%]
tests/integration/test_account_routes.py::TestAccountRoutes::test_get_account_not_owner PASSED [  7%]
tests/integration/test_account_routes.py::TestAccountRoutes::test_update_account_name PASSED [  7%]
tests/integration/test_account_routes.py::TestAccountRoutes::test_update_account_is_active PASSED [  7%]
tests/integration/test_account_routes.py::TestAccountRoutes::test_update_account_duplicate_name PASSED [  8%]
tests/integration/test_account_routes.py::TestAccountRoutes::test_delete_account_success PASSED [  8%]
tests/integration/test_account_routes.py::TestAccountRoutes::test_delete_account_not_owner PASSED [  8%]
tests/integration/test_account_routes.py::TestAccountRoutes::test_delete_account_not_found PASSED [  8%]
tests/integration/test_account_sharing_routes.py::test_create_share_viewer_success FAILED [  9%]
tests/integration/test_account_sharing_routes.py::test_create_share_editor_success FAILED [  9%]
tests/integration/test_account_sharing_routes.py::test_create_share_cannot_grant_owner_permission FAILED [  9%]
tests/integration/test_account_sharing_routes.py::test_create_share_non_owner_cannot_share FAILED [ 10%]
tests/integration/test_account_sharing_routes.py::test_create_share_cannot_share_with_self FAILED [ 10%]
tests/integration/test_account_sharing_routes.py::test_create_share_nonexistent_account FAILED [ 10%]
tests/integration/test_account_sharing_routes.py::test_create_share_nonexistent_user FAILED [ 11%]
tests/integration/test_account_sharing_routes.py::test_create_share_duplicate_share FAILED [ 11%]
tests/integration/test_account_sharing_routes.py::test_list_shares_owner_sees_all FAILED [ 11%]
tests/integration/test_account_sharing_routes.py::test_list_shares_editor_can_view FAILED [ 11%]
tests/integration/test_account_sharing_routes.py::test_list_shares_viewer_can_view FAILED [ 12%]
tests/integration/test_account_sharing_routes.py::test_list_shares_non_member_cannot_view FAILED [ 12%]
tests/integration/test_account_sharing_routes.py::test_list_shares_empty_for_unshared_account FAILED [ 12%]
tests/integration/test_account_sharing_routes.py::test_update_share_upgrade_viewer_to_editor FAILED [ 13%]
tests/integration/test_account_sharing_routes.py::test_update_share_downgrade_editor_to_viewer FAILED [ 13%]
tests/integration/test_account_sharing_routes.py::test_update_share_cannot_grant_owner_permission FAILED [ 13%]
tests/integration/test_account_sharing_routes.py::test_update_share_non_owner_cannot_update FAILED [ 14%]
tests/integration/test_account_sharing_routes.py::test_update_share_nonexistent_share FAILED [ 14%]
tests/integration/test_account_sharing_routes.py::test_update_share_cannot_modify_owner_share FAILED [ 14%]
tests/integration/test_account_sharing_routes.py::test_revoke_share_viewer_success FAILED [ 14%]
tests/integration/test_account_sharing_routes.py::test_revoke_share_editor_success FAILED [ 15%]
tests/integration/test_account_sharing_routes.py::test_revoke_share_non_owner_cannot_revoke FAILED [ 15%]
tests/integration/test_account_sharing_routes.py::test_revoke_share_cannot_revoke_owner_share FAILED [ 15%]
tests/integration/test_account_sharing_routes.py::test_revoke_share_user_loses_access_immediately FAILED [ 16%]
tests/integration/test_account_sharing_routes.py::test_shared_viewer_cannot_create_transaction PASSED [ 16%]
tests/integration/test_account_sharing_routes.py::test_shared_editor_cannot_delete_account PASSED [ 16%]
tests/integration/test_auth_routes.py::TestRegistration::test_register_success PASSED [ 17%]
tests/integration/test_auth_routes.py::TestRegistration::test_register_duplicate_email PASSED [ 17%]
tests/integration/test_auth_routes.py::TestRegistration::test_register_duplicate_username PASSED [ 17%]
tests/integration/test_auth_routes.py::TestRegistration::test_register_weak_password PASSED [ 17%]
tests/integration/test_auth_routes.py::TestRegistration::test_register_invalid_email PASSED [ 18%]
tests/integration/test_auth_routes.py::TestLogin::test_login_success PASSED [ 18%]
tests/integration/test_auth_routes.py::TestLogin::test_login_invalid_email PASSED [ 18%]
tests/integration/test_auth_routes.py::TestLogin::test_login_invalid_password PASSED [ 19%]
tests/integration/test_auth_routes.py::TestLogin::test_login_inactive_user PASSED [ 19%]
tests/integration/test_auth_routes.py::TestTokenRefresh::test_refresh_success PASSED [ 19%]
tests/integration/test_auth_routes.py::TestTokenRefresh::test_refresh_invalid_token PASSED [ 20%]
tests/integration/test_auth_routes.py::TestTokenRefresh::test_refresh_access_token_fails PASSED [ 20%]
tests/integration/test_auth_routes.py::TestTokenRefresh::test_refresh_token_reuse_detection PASSED [ 20%]
tests/integration/test_auth_routes.py::TestLogout::test_logout_success PASSED [ 20%]
tests/integration/test_auth_routes.py::TestLogout::test_logout_invalid_token PASSED [ 21%]
tests/integration/test_auth_routes.py::TestPasswordChange::test_change_password_success FAILED [ 21%]
tests/integration/test_auth_routes.py::TestPasswordChange::test_change_password_wrong_current PASSED [ 21%]
tests/integration/test_auth_routes.py::TestPasswordChange::test_change_password_weak_new_password PASSED [ 22%]
tests/integration/test_auth_routes.py::TestPasswordChange::test_change_password_unauthenticated PASSED [ 22%]
tests/integration/test_auth_routes.py::TestAuthorization::test_access_with_valid_token PASSED [ 22%]
tests/integration/test_auth_routes.py::TestAuthorization::test_access_without_token PASSED [ 23%]
tests/integration/test_auth_routes.py::TestAuthorization::test_access_with_invalid_token PASSED [ 23%]
tests/integration/test_auth_routes.py::TestAuthenticationFlows::test_full_user_lifecycle PASSED [ 23%]
tests/integration/test_auth_routes.py::TestAuthenticationFlows::test_password_change_flow PASSED [ 23%]
tests/integration/test_metadata_routes.py::TestAccountTypesEndpoint::test_get_account_types_success PASSED [ 24%]
tests/integration/test_metadata_routes.py::TestAccountTypesEndpoint::test_get_account_types_response_structure PASSED [ 24%]
tests/integration/test_metadata_routes.py::TestAccountTypesEndpoint::test_get_account_types_contains_all_types PASSED [ 24%]
tests/integration/test_metadata_routes.py::TestAccountTypesEndpoint::test_get_account_types_item_structure PASSED [ 25%]
tests/integration/test_metadata_routes.py::TestAccountTypesEndpoint::test_get_account_types_labels_are_capitalized PASSED [ 25%]
tests/integration/test_metadata_routes.py::TestCurrenciesEndpoint::test_get_currencies_success PASSED [ 25%]
tests/integration/test_metadata_routes.py::TestCurrenciesEndpoint::test_get_currencies_response_structure PASSED [ 26%]
tests/integration/test_metadata_routes.py::TestCurrenciesEndpoint::test_get_currencies_has_minimum_currencies PASSED [ 26%]
tests/integration/test_metadata_routes.py::TestCurrenciesEndpoint::test_get_currencies_item_structure PASSED [ 26%]
tests/integration/test_metadata_routes.py::TestCurrenciesEndpoint::test_get_currencies_codes_are_uppercase PASSED [ 26%]
tests/integration/test_metadata_routes.py::TestCurrenciesEndpoint::test_get_currencies_contains_major_currencies PASSED [ 27%]
tests/integration/test_metadata_routes.py::TestCurrenciesEndpoint::test_get_currencies_no_duplicates PASSED [ 27%]
tests/integration/test_metadata_routes.py::TestCurrenciesEndpoint::test_get_currencies_symbols_valid_json PASSED [ 27%]
tests/integration/test_metadata_routes.py::TestTransactionTypesEndpoint::test_get_transaction_types_success PASSED [ 28%]
tests/integration/test_metadata_routes.py::TestTransactionTypesEndpoint::test_get_transaction_types_response_structure PASSED [ 28%]
tests/integration/test_metadata_routes.py::TestTransactionTypesEndpoint::test_get_transaction_types_contains_all_types PASSED [ 28%]
tests/integration/test_metadata_routes.py::TestTransactionTypesEndpoint::test_get_transaction_types_item_structure PASSED [ 29%]
tests/integration/test_metadata_routes.py::TestTransactionTypesEndpoint::test_get_transaction_types_labels_are_capitalized PASSED [ 29%]
tests/integration/test_metadata_routes.py::TestMetadataEndpointsNoAuth::test_account_types_no_auth_required PASSED [ 29%]
tests/integration/test_metadata_routes.py::TestMetadataEndpointsNoAuth::test_currencies_no_auth_required PASSED [ 29%]
tests/integration/test_metadata_routes.py::TestMetadataEndpointsNoAuth::test_transaction_types_no_auth_required PASSED [ 30%]
tests/integration/test_transaction_api.py::TestTransactionAPI::test_create_transaction FAILED [ 30%]
tests/integration/test_transaction_api.py::TestTransactionAPI::test_list_transactions FAILED [ 30%]
tests/integration/test_transaction_api.py::TestTransactionAPI::test_get_transaction FAILED [ 31%]
tests/integration/test_transaction_api.py::TestTransactionAPI::test_update_transaction FAILED [ 31%]
tests/integration/test_transaction_api.py::TestTransactionAPI::test_delete_transaction FAILED [ 31%]
tests/integration/test_transaction_api.py::TestTransactionAPI::test_split_transaction FAILED [ 32%]
tests/integration/test_transaction_api.py::TestTransactionAPI::test_join_split_transaction FAILED [ 32%]
tests/integration/test_transaction_api.py::TestTransactionAPI::test_add_tag FAILED [ 32%]
tests/integration/test_transaction_api.py::TestTransactionAPI::test_remove_tag FAILED [ 32%]
tests/integration/test_transaction_api.py::TestTransactionAPI::test_permission_denied FAILED [ 33%]
tests/integration/test_transaction_api.py::test_viewer_cannot_create_transaction FAILED [ 33%]
tests/integration/test_transaction_api.py::test_viewer_cannot_update_transaction FAILED [ 33%]
tests/integration/test_transaction_api.py::test_viewer_cannot_delete_transaction FAILED [ 34%]
tests/integration/test_transaction_api.py::test_editor_can_create_transaction FAILED [ 34%]
tests/integration/test_transaction_api.py::test_owner_has_full_access FAILED [ 34%]
tests/integration/test_transaction_api.py::test_cannot_create_transaction_with_wrong_currency FAILED [ 35%]
tests/integration/test_transaction_api.py::test_cannot_create_transaction_with_zero_amount PASSED [ 35%]
tests/integration/test_transaction_api.py::test_split_transaction_maintains_balance FAILED [ 35%]
tests/integration/test_transaction_api.py::test_cannot_split_already_split_transaction FAILED [ 35%]
tests/integration/test_transaction_api.py::test_cannot_create_transaction_in_non_member_account FAILED [ 36%]
tests/integration/test_transaction_api.py::test_cannot_access_another_users_transaction FAILED [ 36%]
tests/unit/core/test_security.py::TestPasswordHashing::test_hash_password_returns_string PASSED [ 36%]
tests/unit/core/test_security.py::TestPasswordHashing::test_hash_password_different_for_same_password PASSED [ 37%]
tests/unit/core/test_security.py::TestPasswordHashing::test_verify_password_correct_password PASSED [ 37%]
tests/unit/core/test_security.py::TestPasswordHashing::test_verify_password_incorrect_password PASSED [ 37%]
tests/unit/core/test_security.py::TestPasswordHashing::test_verify_password_invalid_hash PASSED [ 38%]
tests/unit/core/test_security.py::TestPasswordHashing::test_verify_password_handles_verify_mismatch_error PASSED [ 38%]
tests/unit/core/test_security.py::TestPasswordHashing::test_verify_password_handles_invalid_hash_error PASSED [ 38%]
tests/unit/core/test_security.py::TestPasswordStrengthValidation::test_validate_strong_password PASSED [ 38%]
tests/unit/core/test_security.py::TestPasswordStrengthValidation::test_validate_too_short_password PASSED [ 39%]
tests/unit/core/test_security.py::TestPasswordStrengthValidation::test_validate_no_uppercase PASSED [ 39%]
tests/unit/core/test_security.py::TestPasswordStrengthValidation::test_validate_no_lowercase PASSED [ 39%]
tests/unit/core/test_security.py::TestPasswordStrengthValidation::test_validate_no_digit PASSED [ 40%]
tests/unit/core/test_security.py::TestPasswordStrengthValidation::test_validate_no_special_character PASSED [ 40%]
tests/unit/core/test_security.py::TestPasswordStrengthValidation::test_validate_all_special_characters_allowed PASSED [ 40%]
tests/unit/core/test_security.py::TestJWTAccessToken::test_create_access_token_structure PASSED [ 41%]
tests/unit/core/test_security.py::TestJWTAccessToken::test_create_access_token_default_expiration PASSED [ 41%]
tests/unit/core/test_security.py::TestJWTAccessToken::test_create_access_token_custom_expiration PASSED [ 41%]
tests/unit/core/test_security.py::TestJWTAccessToken::test_create_access_token_includes_jti PASSED [ 41%]
tests/unit/core/test_security.py::TestJWTAccessToken::test_create_access_token_preserves_custom_claims PASSED [ 42%]
tests/unit/core/test_security.py::TestJWTRefreshToken::test_create_refresh_token_structure PASSED [ 42%]
tests/unit/core/test_security.py::TestJWTRefreshToken::test_create_refresh_token_default_expiration PASSED [ 42%]
tests/unit/core/test_security.py::TestJWTRefreshToken::test_create_refresh_token_includes_jti PASSED [ 43%]
tests/unit/core/test_security.py::TestDecodeToken::test_decode_valid_token PASSED [ 43%]
tests/unit/core/test_security.py::TestDecodeToken::test_decode_invalid_token_raises_error PASSED [ 43%]
tests/unit/core/test_security.py::TestDecodeToken::test_decode_logs_jwt_errors PASSED [ 44%]
tests/unit/core/test_security.py::TestVerifyTokenType::test_verify_access_token_type PASSED [ 44%]
tests/unit/core/test_security.py::TestVerifyTokenType::test_verify_refresh_token_type PASSED [ 44%]
tests/unit/core/test_security.py::TestVerifyTokenType::test_verify_missing_type_returns_false PASSED [ 44%]
tests/unit/core/test_security.py::TestRefreshTokenHashing::test_hash_refresh_token_returns_string PASSED [ 45%]
tests/unit/core/test_security.py::TestRefreshTokenHashing::test_hash_refresh_token_deterministic PASSED [ 45%]
tests/unit/core/test_security.py::TestRefreshTokenHashing::test_hash_different_tokens_produce_different_hashes PASSED [ 45%]
tests/unit/core/test_security.py::TestRefreshTokenHashing::test_verify_refresh_token_hash_correct_token PASSED [ 46%]
tests/unit/core/test_security.py::TestRefreshTokenHashing::test_verify_refresh_token_hash_incorrect_token PASSED [ 46%]
tests/unit/core/test_security.py::TestTokenUniqueness::test_access_tokens_created_simultaneously_are_unique PASSED [ 46%]
tests/unit/core/test_security.py::TestTokenUniqueness::test_refresh_tokens_created_simultaneously_are_unique PASSED [ 47%]
tests/unit/repositories/test_account_repository.py::TestAccountRepository::test_create_account FAILED [ 47%]
tests/unit/repositories/test_account_repository.py::TestAccountRepository::test_get_by_id ERROR [ 47%]
tests/unit/repositories/test_account_repository.py::TestAccountRepository::test_get_by_user ERROR [ 47%]
tests/unit/repositories/test_account_repository.py::TestAccountRepository::test_get_by_user_with_filters ERROR [ 48%]
tests/unit/repositories/test_account_repository.py::TestAccountRepository::test_get_by_user_pagination ERROR [ 48%]
tests/unit/repositories/test_account_repository.py::TestAccountRepository::test_get_by_name ERROR [ 48%]
tests/unit/repositories/test_account_repository.py::TestAccountRepository::test_exists_by_name ERROR [ 49%]
tests/unit/repositories/test_account_repository.py::TestAccountRepository::test_exists_by_name_with_exclude ERROR [ 49%]
tests/unit/repositories/test_account_repository.py::TestAccountRepository::test_count_user_accounts ERROR [ 49%]
tests/unit/repositories/test_account_repository.py::TestAccountRepository::test_soft_delete_filtering ERROR [ 50%]
tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_create_transaction ERROR [ 50%]
tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_get_by_id ERROR [ 50%]
tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_get_by_account_id ERROR [ 50%]
tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_count_by_account_id ERROR [ 51%]
tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_search_by_date_range ERROR [ 51%]
tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_search_by_amount_range ERROR [ 51%]
tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_search_by_type ERROR [ 52%]
tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_get_children ERROR [ 52%]
tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_has_children ERROR [ 52%]
tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_calculate_account_balance ERROR [ 52%]
tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_get_balance_at_date ERROR [ 53%]
tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_soft_delete_filtering ERROR [ 53%]
tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_pagination ERROR [ 53%]
tests/unit/repositories/test_transaction_tag_repository.py::TestTransactionTagRepository::test_add_tag ERROR [ 54%]
tests/unit/repositories/test_transaction_tag_repository.py::TestTransactionTagRepository::test_tag_normalization ERROR [ 54%]
tests/unit/repositories/test_transaction_tag_repository.py::TestTransactionTagRepository::test_remove_tag ERROR [ 54%]
tests/unit/repositories/test_transaction_tag_repository.py::TestTransactionTagRepository::test_remove_nonexistent_tag ERROR [ 55%]
tests/unit/repositories/test_transaction_tag_repository.py::TestTransactionTagRepository::test_get_tags ERROR [ 55%]
tests/unit/repositories/test_transaction_tag_repository.py::TestTransactionTagRepository::test_get_all_tags_for_account ERROR [ 55%]
tests/unit/repositories/test_transaction_tag_repository.py::TestTransactionTagRepository::test_get_tag_usage_counts ERROR [ 55%]
tests/unit/repositories/test_transaction_tag_repository.py::TestTransactionTagRepository::test_exists ERROR [ 56%]
tests/unit/repositories/test_transaction_tag_repository.py::TestTransactionTagRepository::test_duplicate_tag_prevention ERROR [ 56%]
tests/unit/repositories/test_transaction_tag_repository.py::TestTransactionTagRepository::test_tags_sorted_alphabetically ERROR [ 56%]
tests/unit/services/test_account_service.py::TestAccountService::test_create_account_success ERROR [ 57%]
tests/unit/services/test_account_service.py::TestAccountService::test_create_account_duplicate_name ERROR [ 57%]
tests/unit/services/test_account_service.py::TestAccountService::test_create_account_invalid_currency ERROR [ 57%]
tests/unit/services/test_account_service.py::TestAccountService::test_create_account_negative_balance ERROR [ 58%]
tests/unit/services/test_account_service.py::TestAccountService::test_get_account_success ERROR [ 58%]
tests/unit/services/test_account_service.py::TestAccountService::test_get_account_not_owner ERROR [ 58%]
tests/unit/services/test_account_service.py::TestAccountService::test_get_account_not_found ERROR [ 58%]
tests/unit/services/test_account_service.py::TestAccountService::test_list_accounts ERROR [ 59%]
tests/unit/services/test_account_service.py::TestAccountService::test_list_accounts_with_filters ERROR [ 59%]
tests/unit/services/test_account_service.py::TestAccountService::test_list_accounts_pagination ERROR [ 59%]
tests/unit/services/test_account_service.py::TestAccountService::test_list_accounts_limit_enforced ERROR [ 60%]
tests/unit/services/test_account_service.py::TestAccountService::test_update_account_name ERROR [ 60%]
tests/unit/services/test_account_service.py::TestAccountService::test_update_account_is_active ERROR [ 60%]
tests/unit/services/test_account_service.py::TestAccountService::test_update_account_duplicate_name ERROR [ 61%]
tests/unit/services/test_account_service.py::TestAccountService::test_update_account_no_changes ERROR [ 61%]
tests/unit/services/test_account_service.py::TestAccountService::test_delete_account ERROR [ 61%]
tests/unit/services/test_account_service.py::TestAccountService::test_delete_account_not_owner ERROR [ 61%]
tests/unit/services/test_account_service.py::TestAccountService::test_count_user_accounts ERROR [ 62%]
tests/unit/services/test_audit_service.py::TestLogEvent::test_log_event_creates_audit_log PASSED [ 62%]
tests/unit/services/test_audit_service.py::TestLogEvent::test_log_event_with_minimal_parameters PASSED [ 62%]
tests/unit/services/test_audit_service.py::TestLogEvent::test_log_event_with_null_user_id PASSED [ 63%]
tests/unit/services/test_audit_service.py::TestLogLogin::test_log_successful_login PASSED [ 63%]
tests/unit/services/test_audit_service.py::TestLogLogin::test_log_failed_login PASSED [ 63%]
tests/unit/services/test_audit_service.py::TestLogLogout::test_log_logout PASSED [ 64%]
tests/unit/services/test_audit_service.py::TestLogPasswordChange::test_log_successful_password_change PASSED [ 64%]
tests/unit/services/test_audit_service.py::TestLogPasswordChange::test_log_failed_password_change PASSED [ 64%]
tests/unit/services/test_audit_service.py::TestLogTokenRefresh::test_log_successful_token_refresh PASSED [ 64%]
tests/unit/services/test_audit_service.py::TestLogTokenRefresh::test_log_failed_token_refresh PASSED [ 65%]
tests/unit/services/test_audit_service.py::TestLogDataChange::test_log_create_action PASSED [ 65%]
tests/unit/services/test_audit_service.py::TestLogDataChange::test_log_update_action PASSED [ 65%]
tests/unit/services/test_audit_service.py::TestLogDataChange::test_log_delete_action PASSED [ 66%]
tests/unit/services/test_audit_service.py::TestGetUserAuditLogs::test_get_user_audit_logs_with_filters PASSED [ 66%]
tests/unit/services/test_audit_service.py::TestGetUserAuditLogs::test_get_user_audit_logs_with_pagination PASSED [ 66%]
tests/unit/services/test_audit_service.py::TestGetUserAuditLogs::test_get_user_audit_logs_no_results PASSED [ 67%]
tests/unit/services/test_audit_service.py::TestGetAllAuditLogs::test_get_all_audit_logs_with_filters PASSED [ 67%]
tests/unit/services/test_audit_service.py::TestGetAllAuditLogs::test_get_all_audit_logs_no_filters PASSED [ 67%]
tests/unit/services/test_audit_service.py::TestGetAllAuditLogs::test_get_all_audit_logs_by_entity_type PASSED [ 67%]
tests/unit/services/test_auth_service.py::TestRegister::test_register_success PASSED [ 68%]
tests/unit/services/test_auth_service.py::TestRegister::test_register_email_already_exists PASSED [ 68%]
tests/unit/services/test_auth_service.py::TestRegister::test_register_username_already_exists PASSED [ 68%]
tests/unit/services/test_auth_service.py::TestLogin::test_login_success PASSED [ 69%]
tests/unit/services/test_auth_service.py::TestLogin::test_login_user_not_found PASSED [ 69%]
tests/unit/services/test_auth_service.py::TestLogin::test_login_wrong_password PASSED [ 69%]
tests/unit/services/test_auth_service.py::TestLogin::test_login_inactive_user PASSED [ 70%]
tests/unit/services/test_auth_service.py::TestRefreshAccessToken::test_refresh_token_success PASSED [ 70%]
tests/unit/services/test_auth_service.py::TestRefreshAccessToken::test_refresh_token_invalid_jwt PASSED [ 70%]
tests/unit/services/test_auth_service.py::TestRefreshAccessToken::test_refresh_token_wrong_type PASSED [ 70%]
tests/unit/services/test_auth_service.py::TestRefreshAccessToken::test_refresh_token_not_in_database PASSED [ 71%]
tests/unit/services/test_auth_service.py::TestRefreshAccessToken::test_refresh_token_reuse_detection PASSED [ 71%]
tests/unit/services/test_auth_service.py::TestRefreshAccessToken::test_refresh_token_expired PASSED [ 71%]
tests/unit/services/test_auth_service.py::TestRefreshAccessToken::test_refresh_token_inactive_user PASSED [ 72%]
tests/unit/services/test_auth_service.py::TestLogout::test_logout_success PASSED [ 72%]
tests/unit/services/test_auth_service.py::TestLogout::test_logout_invalid_jwt PASSED [ 72%]
tests/unit/services/test_auth_service.py::TestLogout::test_logout_wrong_token_type PASSED [ 73%]
tests/unit/services/test_auth_service.py::TestLogout::test_logout_token_not_found PASSED [ 73%]
tests/unit/services/test_auth_service.py::TestChangePassword::test_change_password_success PASSED [ 73%]
tests/unit/services/test_auth_service.py::TestChangePassword::test_change_password_user_not_found PASSED [ 73%]
tests/unit/services/test_auth_service.py::TestChangePassword::test_change_password_wrong_current_password PASSED [ 74%]
tests/unit/services/test_auth_service.py::TestGenerateTokens::test_generate_tokens_new_family PASSED [ 74%]
tests/unit/services/test_auth_service.py::TestGenerateTokens::test_generate_tokens_existing_family PASSED [ 74%]
tests/unit/services/test_encryption_service.py::TestEncryptionService::test_encrypt_then_decrypt_returns_original PASSED [ 75%]
tests/unit/services/test_encryption_service.py::TestEncryptionService::test_encrypt_produces_different_ciphertexts PASSED [ 75%]
tests/unit/services/test_encryption_service.py::TestEncryptionService::test_encrypt_empty_string_returns_empty_string PASSED [ 75%]
tests/unit/services/test_encryption_service.py::TestEncryptionService::test_decrypt_empty_string_returns_empty_string PASSED [ 76%]
tests/unit/services/test_encryption_service.py::TestEncryptionService::test_decrypt_tampered_ciphertext_raises_error PASSED [ 76%]
tests/unit/services/test_encryption_service.py::TestEncryptionService::test_decrypt_invalid_token_raises_error PASSED [ 76%]
tests/unit/services/test_encryption_service.py::TestEncryptionService::test_key_derivation_is_deterministic PASSED [ 76%]
tests/unit/services/test_encryption_service.py::TestEncryptionService::test_encrypt_unicode_characters PASSED [ 77%]
tests/unit/services/test_encryption_service.py::TestEncryptionService::test_encrypt_long_string PASSED [ 77%]
tests/unit/services/test_encryption_service.py::TestEncryptionService::test_encrypt_special_characters PASSED [ 77%]
tests/unit/services/test_encryption_service.py::TestEncryptionService::test_ciphertext_is_url_safe_base64 PASSED [ 78%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceCreate::test_create_transaction_success ERROR [ 78%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceCreate::test_create_transaction_updates_balance ERROR [ 78%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceCreate::test_create_transaction_currency_mismatch ERROR [ 79%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceCreate::test_create_transaction_zero_amount ERROR [ 79%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceCreate::test_create_transaction_permission_denied ERROR [ 79%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceRead::test_get_transaction_success ERROR [ 79%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceRead::test_get_transaction_not_found ERROR [ 80%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceRead::test_get_transaction_permission_denied ERROR [ 80%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceRead::test_search_transactions ERROR [ 80%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceUpdate::test_update_transaction_success ERROR [ 81%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceUpdate::test_update_transaction_balance_delta ERROR [ 81%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceUpdate::test_update_transaction_zero_amount ERROR [ 81%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceUpdate::test_update_transaction_permission_denied ERROR [ 82%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceDelete::test_delete_transaction_success ERROR [ 82%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceDelete::test_delete_transaction_updates_balance ERROR [ 82%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceDelete::test_delete_parent_deletes_children ERROR [ 82%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceSplit::test_split_transaction_success ERROR [ 83%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceSplit::test_split_transaction_amounts_must_sum ERROR [ 83%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceSplit::test_split_requires_minimum_two_splits ERROR [ 83%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceSplit::test_cannot_split_child_transaction ERROR [ 84%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceSplit::test_join_split_transaction ERROR [ 84%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceSplit::test_join_requires_splits ERROR [ 84%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceTags::test_add_tag_success ERROR [ 85%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceTags::test_remove_tag_success ERROR [ 85%]
tests/unit/services/test_transaction_service.py::TestTransactionServiceTags::test_tag_permission_denied ERROR [ 85%]
tests/unit/services/test_user_service.py::TestGetUserProfile::test_get_own_profile PASSED [ 85%]
tests/unit/services/test_user_service.py::TestGetUserProfile::test_admin_view_other_profile PASSED [ 86%]
tests/unit/services/test_user_service.py::TestGetUserProfile::test_user_cannot_view_other_profile PASSED [ 86%]
tests/unit/services/test_user_service.py::TestGetUserProfile::test_get_profile_user_not_found PASSED [ 86%]
tests/unit/services/test_user_service.py::TestUpdateUserProfile::test_update_own_profile PASSED [ 87%]
tests/unit/services/test_user_service.py::TestUpdateUserProfile::test_update_email_uniqueness_check PASSED [ 87%]
tests/unit/services/test_user_service.py::TestUpdateUserProfile::test_update_username_uniqueness_check PASSED [ 87%]
tests/unit/services/test_user_service.py::TestUpdateUserProfile::test_admin_update_other_profile PASSED [ 88%]
tests/unit/services/test_user_service.py::TestUpdateUserProfile::test_user_cannot_update_other_profile PASSED [ 88%]
tests/unit/services/test_user_service.py::TestUpdateUserProfile::test_update_profile_user_not_found PASSED [ 88%]
tests/unit/services/test_user_service.py::TestListUsers::test_list_users_as_admin PASSED [ 88%]
tests/unit/services/test_user_service.py::TestListUsers::test_list_users_with_filters PASSED [ 89%]
tests/unit/services/test_user_service.py::TestListUsers::test_list_users_not_admin PASSED [ 89%]
tests/unit/services/test_user_service.py::TestDeactivateUser::test_deactivate_user_as_admin PASSED [ 89%]
tests/unit/services/test_user_service.py::TestDeactivateUser::test_deactivate_user_not_admin PASSED [ 90%]
tests/unit/services/test_user_service.py::TestDeactivateUser::test_deactivate_user_not_found PASSED [ 90%]
tests/unit/services/test_user_service.py::TestSoftDeleteUser::test_soft_delete_user_as_admin PASSED [ 90%]
tests/unit/services/test_user_service.py::TestSoftDeleteUser::test_soft_delete_user_not_admin PASSED [ 91%]
tests/unit/services/test_user_service.py::TestSoftDeleteUser::test_soft_delete_user_not_found PASSED [ 91%]
tests/unit/test_currency_service.py::TestCurrency::test_currency_creation PASSED [ 91%]
tests/unit/test_currency_service.py::TestCurrency::test_currency_create_factory PASSED [ 91%]
tests/unit/test_currency_service.py::TestCurrency::test_currency_is_frozen PASSED [ 92%]
tests/unit/test_currency_service.py::TestCurrency::test_currency_validation PASSED [ 92%]
tests/unit/test_currency_service.py::TestCurrencyService::test_singleton_pattern PASSED [ 92%]
tests/unit/test_currency_service.py::TestCurrencyService::test_get_currency_service_returns_singleton PASSED [ 93%]
tests/unit/test_currency_service.py::TestCurrencyService::test_get_all_returns_currencies PASSED [ 93%]
tests/unit/test_currency_service.py::TestCurrencyService::test_get_all_returns_copy PASSED [ 93%]
tests/unit/test_currency_service.py::TestCurrencyService::test_all_currencies_have_required_fields PASSED [ 94%]
tests/unit/test_currency_service.py::TestCurrencyService::test_no_duplicate_currency_codes PASSED [ 94%]
tests/unit/test_currency_service.py::TestCurrencyService::test_get_by_code_found PASSED [ 94%]
tests/unit/test_currency_service.py::TestCurrencyService::test_get_by_code_case_insensitive PASSED [ 94%]
tests/unit/test_currency_service.py::TestCurrencyService::test_get_by_code_not_found PASSED [ 95%]
tests/unit/test_currency_service.py::TestCurrencyService::test_is_supported_true PASSED [ 95%]
tests/unit/test_currency_service.py::TestCurrencyService::test_is_supported_case_insensitive PASSED [ 95%]
tests/unit/test_currency_service.py::TestCurrencyService::test_is_supported_false PASSED [ 96%]
tests/unit/test_currency_service.py::TestCurrencyService::test_specific_currencies_exist PASSED [ 96%]
tests/unit/test_currency_service.py::TestCurrencyService::test_currency_symbols_are_valid_utf8 PASSED [ 96%]
tests/unit/test_enums.py::TestAccountType::test_account_type_values PASSED [ 97%]
tests/unit/test_enums.py::TestAccountType::test_account_type_count PASSED [ 97%]
tests/unit/test_enums.py::TestAccountType::test_account_type_to_dict_list PASSED [ 97%]
tests/unit/test_enums.py::TestAccountType::test_account_type_string_enum PASSED [ 97%]
tests/unit/test_enums.py::TestAccountType::test_account_type_iteration PASSED [ 98%]
tests/unit/test_enums.py::TestTransactionType::test_transaction_type_values PASSED [ 98%]
tests/unit/test_enums.py::TestTransactionType::test_transaction_type_count PASSED [ 98%]
tests/unit/test_enums.py::TestTransactionType::test_transaction_type_to_dict_list PASSED [ 99%]
tests/unit/test_enums.py::TestTransactionType::test_transaction_type_string_enum PASSED [ 99%]
tests/unit/test_enums.py::TestTransactionType::test_transaction_type_iteration PASSED [ 99%]
tests/unit/test_enums.py::TestTransactionType::test_transaction_type_dict_list_format PASSED [100%]

==================================== ERRORS ====================================
____________ ERROR at setup of TestAccountRepository.test_get_by_id ____________
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$aHO1XOLNt/85+ZB3B5lWnA$n4PeKj9vxfQGS8oYSkgbgVrJg4J8qGYmdSbdnDJnWEE', None, True, False, None, UUID('add3bb42-210a-4255-aba9-d36c4e1f9749'), datetime.datetime(2025, 11, 26, 10, 9, 36, 958708, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 36, 958710, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:36,887", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
___________ ERROR at setup of TestAccountRepository.test_get_by_user ___________
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$/McWmWuJ6pwyduGMgy5CCg$qMyvwYkb56lhwolQdtIPygUVdjPjcMOOwmmIf58NFng', None, True, False, None, UUID('5e99fd9c-2c09-4d2e-9fb4-572d8deeefae'), datetime.datetime(2025, 11, 26, 10, 9, 37, 304847, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 37, 304851, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:37,231", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
____ ERROR at setup of TestAccountRepository.test_get_by_user_with_filters _____
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$iN7RGhuclzOe89Ccc8/5cA$jxhEI46GBgHY8JdJljCE766yn4xKEB6nDSR8vJVAYMc', None, True, False, None, UUID('355c8ba3-cada-4fc7-9960-d03833f9bc50'), datetime.datetime(2025, 11, 26, 10, 9, 37, 648453, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 37, 648457, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:37,561", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_____ ERROR at setup of TestAccountRepository.test_get_by_user_pagination ______
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$zqtUKrKqG8AF+tU1tGE+2g$xpzMx9LzO5Vpvig+R4PXn1Icha86kYkA6jOoZIXikKY', None, True, False, None, UUID('1a9cc76a-fb98-439b-8d33-495383cd6c58'), datetime.datetime(2025, 11, 26, 10, 9, 37, 980309, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 37, 980313, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:37,905", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
___________ ERROR at setup of TestAccountRepository.test_get_by_name ___________
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$vX9tA4chkiv4vwbZ6Vv/Yw$CJI6wkHYNJKQzrqDQe25VpzqA7FLdc+gU/4bbLzmj3Y', None, True, False, None, UUID('96345d24-d2d3-44ac-9ad8-a77ba8090800'), datetime.datetime(2025, 11, 26, 10, 9, 38, 331078, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 38, 331082, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:38,242", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_________ ERROR at setup of TestAccountRepository.test_exists_by_name __________
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$RQ1nnSg25ZGX1+Rwd22Tdg$Sqd8z2p1d0Wq1RI0sHB3knUTfcHVRZbywNg9HK8UxR4', None, True, False, None, UUID('ce2284d0-96ab-4882-9234-abbcdfb4ef3c'), datetime.datetime(2025, 11, 26, 10, 9, 38, 659174, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 38, 659179, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:38,591", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
___ ERROR at setup of TestAccountRepository.test_exists_by_name_with_exclude ___
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$auFvOv9oDiFdswRszWPNPg$aoLq4vyDkdAzbDIWokM/tNf+DmQBa8Xhzu6Hv9hu41Y', None, True, False, None, UUID('42be67c7-16cd-4aab-836d-6e56ceed4d0f'), datetime.datetime(2025, 11, 26, 10, 9, 38, 991164, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 38, 991169, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:38,918", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_______ ERROR at setup of TestAccountRepository.test_count_user_accounts _______
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$wedYG7Xzd86k5m/o7hAEIg$oNdg59ch905qRYzUAbcYuY+wu5CEErJ4Lj+jT5kjmQk', None, True, False, None, UUID('49758118-b487-470d-b090-e6461a013591'), datetime.datetime(2025, 11, 26, 10, 9, 39, 392397, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 39, 392401, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:39,317", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
______ ERROR at setup of TestAccountRepository.test_soft_delete_filtering ______
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$RfMze1ywkL6UPdWRs0bdfw$UekWHcfX1wjIzcE6QwkIVKadA3WCtpQesydpQMB+J1g', None, True, False, None, UUID('89631efa-8e91-4237-8691-517b6d53d9a4'), datetime.datetime(2025, 11, 26, 10, 9, 39, 724735, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 39, 724740, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:39,650", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_____ ERROR at setup of TestTransactionRepository.test_create_transaction ______
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$j3QJWlYpyYKzhAKRisbdTw$ds5J06FkHehqDgZwufZG6OLyIRxIO/YcjzHU95UyO5I', None, True, False, None, UUID('1dda05f0-abda-4a6f-aa84-185fc6c6ae0f'), datetime.datetime(2025, 11, 26, 10, 9, 40, 59796, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 40, 59799, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:39,985", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
__________ ERROR at setup of TestTransactionRepository.test_get_by_id __________
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$esndrcofk2ThfizmuX9KTA$dJ/JYiKnQndGZvA51Mpc1lCN36WUBXr7wX29BRU36ns', None, True, False, None, UUID('135f2fff-641c-4ccb-980b-a63793aa2e96'), datetime.datetime(2025, 11, 26, 10, 9, 40, 397046, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 40, 397050, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:40,322", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
______ ERROR at setup of TestTransactionRepository.test_get_by_account_id ______
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$Cj4s40gY+BosN7gfKnXiZA$3M6X643S4In4jGsrfq0SsDpLpe8uJqlcBD16v9pgjdI', None, True, False, None, UUID('16452e11-8a8f-4cc6-8283-609088c29b75'), datetime.datetime(2025, 11, 26, 10, 9, 40, 719689, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 40, 719693, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:40,652", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_____ ERROR at setup of TestTransactionRepository.test_count_by_account_id _____
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$bbjkizWjeW93SZQCAiErwQ$F33M5kPa3sxoU04fRA6fuRk0/OHhTRBV0KElgB2/n/w', None, True, False, None, UUID('7c892d4a-6715-4774-8416-4ed4ede5e26d'), datetime.datetime(2025, 11, 26, 10, 9, 41, 49217, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 41, 49220, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:40,977", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
____ ERROR at setup of TestTransactionRepository.test_search_by_date_range _____
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$xk3U4mJBix7irH64W2jbvQ$aK/r7u4XmJgnegLMF3FNdVU0CAfE4lYv0SUkphaocUU', None, True, False, None, UUID('dff699af-2f26-49ce-8395-5bb29008f473'), datetime.datetime(2025, 11, 26, 10, 9, 41, 393767, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 41, 393771, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:41,308", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
___ ERROR at setup of TestTransactionRepository.test_search_by_amount_range ____
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$8QMSRnYTHMxlegi9pYaq6A$hZH+TP7LaBUH+d144YrHpfpvR2eaS+jwQiaFXxrk5Qg', None, True, False, None, UUID('70c44d67-b8c4-48a1-97b2-0ff5d4ad2a48'), datetime.datetime(2025, 11, 26, 10, 9, 41, 730030, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 41, 730034, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:41,654", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_______ ERROR at setup of TestTransactionRepository.test_search_by_type ________
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$vzdHLxib/kgmNAzBimvoZA$/ncpM5gZ0NWY5vZgIeABEoIp2CFtEglGlD9+JmN9onQ', None, True, False, None, UUID('f829f01a-7c57-499c-9cc1-a9c40f5e59af'), datetime.datetime(2025, 11, 26, 10, 9, 42, 125077, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 42, 125083, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:41,986", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
________ ERROR at setup of TestTransactionRepository.test_get_children _________
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$zbRalEBf3wnaoqYeTUndHQ$79iIRZIMkdMZ2GtiqzikEiEImyAfc6MVp9RxYITWpGM', None, True, False, None, UUID('f99ce50c-e1e6-438e-a4a1-c5ed2dcb7618'), datetime.datetime(2025, 11, 26, 10, 9, 42, 529105, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 42, 529108, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:42,459", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
________ ERROR at setup of TestTransactionRepository.test_has_children _________
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$g5p71Odzj2HKQPD/JlNmIQ$yZREVzhFtmAGB1INlAdNrc7H8N+BFP6m0We3zuaH6j4', None, True, False, None, UUID('552c798a-ba5c-4e1e-a58c-1cc3e1f9272f'), datetime.datetime(2025, 11, 26, 10, 9, 42, 859087, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 42, 859089, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:42,786", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
__ ERROR at setup of TestTransactionRepository.test_calculate_account_balance __
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$/LjNWStsFPqAGolqJ0oLvg$jNlvTxehnoIoAXgJs1yMD+FEX3Z3nKqjyFGKw8tPues', None, True, False, None, UUID('18af4608-e584-46dd-8730-e7920ec3cb5f'), datetime.datetime(2025, 11, 26, 10, 9, 43, 276211, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 43, 276215, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:43,200", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_____ ERROR at setup of TestTransactionRepository.test_get_balance_at_date _____
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$sop9E1fw260j26WRAPykJQ$D1DNGBwQq8qhweBJFo2B/HvCBVxFDMJpkzWcp/q2PAE', None, True, False, None, UUID('f2a1b8a9-3a66-4dad-a9a4-dda37742589b'), datetime.datetime(2025, 11, 26, 10, 9, 43, 619628, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 43, 619631, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:43,537", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
____ ERROR at setup of TestTransactionRepository.test_soft_delete_filtering ____
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$Sa+aiGUS9eLe2QAmC1pjgA$r0iuCdbbm9QzdrO+1Ak3nA5Gh9r/DBYN9Yfcgjc0ss8', None, True, False, None, UUID('d396d5f2-85f8-4f15-8131-5beb03073d54'), datetime.datetime(2025, 11, 26, 10, 9, 43, 952739, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 43, 952744, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:43,878", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_________ ERROR at setup of TestTransactionRepository.test_pagination __________
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$o7bIQZMuGny2tqY/y2w2Iw$DVjllYRio7C3wVE6WZFMWRPJCzqcowc1T6JIn1lQG2c', None, True, False, None, UUID('909853c9-05b0-41d6-8e0b-8b831c952e41'), datetime.datetime(2025, 11, 26, 10, 9, 44, 273736, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 44, 273740, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:44,212", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_________ ERROR at setup of TestTransactionTagRepository.test_add_tag __________
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$vhvaJAkAsWI/5iEug1dUYg$a4pcjWaD8nsEAxwb10U/9QG9p6bFOKD+6R6R7P/Yy8s', None, True, False, None, UUID('6c0523f8-7670-4152-901b-4e0103ae343b'), datetime.datetime(2025, 11, 26, 10, 9, 44, 628188, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 44, 628192, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:44,536", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
____ ERROR at setup of TestTransactionTagRepository.test_tag_normalization _____
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$jYqN5dJMfcmfuTOjfI0rOg$C/Fn4+llz/Pm/GGf82/Ud/mkz0dzmKKGYDtwg35iB80', None, True, False, None, UUID('d85a04d0-6652-47b2-a1ee-98d32a17e04e'), datetime.datetime(2025, 11, 26, 10, 9, 44, 971268, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 44, 971273, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:44,889", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
________ ERROR at setup of TestTransactionTagRepository.test_remove_tag ________
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$5GgvRFX6oCPpsVsCmUUZiA$6SSYJxa+olrAq8V8qXM5zpSyaKLTkjjfjsoyAWTmvbk', None, True, False, None, UUID('263aaf05-4bd0-458e-afdd-8a6f3241f38f'), datetime.datetime(2025, 11, 26, 10, 9, 45, 306909, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 45, 306913, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:45,232", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
__ ERROR at setup of TestTransactionTagRepository.test_remove_nonexistent_tag __
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$XifVZCVfdQIG+H7Xv24ldg$t2rEAP2AEiMnFTem43TLZcIDyi9p5FK2RRJKFq6/154', None, True, False, None, UUID('fd2feb66-c792-4bc4-8a38-4632baa2033f'), datetime.datetime(2025, 11, 26, 10, 9, 45, 643898, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 45, 643902, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:45,564", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_________ ERROR at setup of TestTransactionTagRepository.test_get_tags _________
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$ztd3HWOpxlW3eTE5qmDtLg$NbHCW1nupLyYfJmT/osSr+Nbgpo372piO428nBuCiLQ', None, True, False, None, UUID('c87bb99f-eeb8-4fd6-ad3a-3f5e2359bf26'), datetime.datetime(2025, 11, 26, 10, 9, 45, 975544, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 45, 975548, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:45,902", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_ ERROR at setup of TestTransactionTagRepository.test_get_all_tags_for_account _
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$3gNWly8HrOufjsiZFQFcag$ozq3o4kcOX1eKfoXHqwYP2XZYQIxkco0097D2d/iuOc', None, True, False, None, UUID('7e96dc3c-5160-48bc-9bbf-ed686b4becd8'), datetime.datetime(2025, 11, 26, 10, 9, 46, 309137, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 46, 309142, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:46,239", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
___ ERROR at setup of TestTransactionTagRepository.test_get_tag_usage_counts ___
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$wOCSb2ofn5WjbmLRWFLWSQ$WsXzYxyqrL7Cur5323Csz8aog70Rbx1EA72E/bj+F7w', None, True, False, None, UUID('6519168f-9627-47c8-b9cd-d7b6ecc0b86f'), datetime.datetime(2025, 11, 26, 10, 9, 46, 645640, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 46, 645644, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:46,570", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
__________ ERROR at setup of TestTransactionTagRepository.test_exists __________
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$r/gVn4gWDxCvWNys/NFNHA$Q/CCsgPNtH2rOXOU/TLpCDbef37kkljCC1LtkDlV5p8', None, True, False, None, UUID('0885d3e8-e11e-48a6-a7df-15b49cecfe01'), datetime.datetime(2025, 11, 26, 10, 9, 47, 76298, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 47, 76307, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:46,993", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_ ERROR at setup of TestTransactionTagRepository.test_duplicate_tag_prevention _
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$Hx6xdzSNUjE76iq0f6+jzQ$F/RHJhW3t4lQoMG7ROetoWr8MWypfgYgcnVFU89SPcQ', None, True, False, None, UUID('8d32ed10-04d5-450c-b3e9-9fd03b6df239'), datetime.datetime(2025, 11, 26, 10, 9, 47, 424416, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 47, 424420, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:47,352", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_ ERROR at setup of TestTransactionTagRepository.test_tags_sorted_alphabetically _
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$O7xTRmYaLnl4DyY9F0PnhQ$5Bh0+DbRw728OagGB3oLOiIbkmN1zATX1hGn6HIskQw', None, True, False, None, UUID('76b00b00-1249-4251-9073-109b2b1b8302'), datetime.datetime(2025, 11, 26, 10, 9, 47, 758184, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 47, 758188, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:47,685", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_______ ERROR at setup of TestAccountService.test_create_account_success _______
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$DwO8D/qj7vL/vpCZw7OrAg$klYY7nzfkC1qjS85aZjgDvA+sCngaFA9EQkfgn0ixAA', None, True, False, None, UUID('cbaa640b-b7ff-4809-992c-029d3e0c0bd3'), datetime.datetime(2025, 11, 26, 10, 9, 48, 93656, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 48, 93661, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:48,019", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
___ ERROR at setup of TestAccountService.test_create_account_duplicate_name ____
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$l/kjsCxqFocW4ssC2il++g$hbljjvM2mMS3GO0Xj9k4dgZcwv8YL0okFRpih54E2rs', None, True, False, None, UUID('08d0049a-0412-4eb1-bdbb-04478e2d752b'), datetime.datetime(2025, 11, 26, 10, 9, 48, 443665, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 48, 443669, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:48,361", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
__ ERROR at setup of TestAccountService.test_create_account_invalid_currency ___
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$+jGaIofUZslGba7JVYz7Xg$a6VPcAUkVZoijETDbNKSIfqIkLqe7va7pfahgsOEAHQ', None, True, False, None, UUID('c23e4853-85cb-486f-9007-83980c945c21'), datetime.datetime(2025, 11, 26, 10, 9, 48, 789330, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 48, 789334, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:48,717", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
__ ERROR at setup of TestAccountService.test_create_account_negative_balance ___
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$d6MClqat4o3zi6Te2ppqSg$4QmomR3hPdr0Vb7q8ag83AcMnBm6ENaS9gsiMZZ0rbY', None, True, False, None, UUID('d82e86fd-81ed-483f-8a7b-98e1d7797adb'), datetime.datetime(2025, 11, 26, 10, 9, 49, 134637, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 49, 134641, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:49,054", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
________ ERROR at setup of TestAccountService.test_get_account_success _________
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$6NWY2nukmmtt3zKeiz2IoQ$wt2ZRClIUMB/hgyIMp/2vgPkSYdWQuQ6j0smqihd9Bw', None, True, False, None, UUID('25bcbab5-9a6a-471d-afa6-3fb47f63bd35'), datetime.datetime(2025, 11, 26, 10, 9, 49, 477346, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 49, 477350, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:49,398", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_______ ERROR at setup of TestAccountService.test_get_account_not_owner ________
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$yWwed5xqMWDy11fLdV3H9w$wkfMRu/q93vicvRpNclHrY47RoqEyw1wk65RxOBHhC4', None, True, False, None, UUID('41572a61-12b4-44e5-98bc-16005dc35956'), datetime.datetime(2025, 11, 26, 10, 9, 49, 830571, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 49, 830576, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:49,742", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_______ ERROR at setup of TestAccountService.test_get_account_not_found ________
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$F57v5Jng+aiN/CA09YELvw$xbtis0tTkltHlYWJA96F1IrhWea5Va+S+dOmyEte7DM', None, True, False, None, UUID('6d30bb49-b61c-4562-8438-18a27fb7baeb'), datetime.datetime(2025, 11, 26, 10, 9, 50, 175553, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 50, 175557, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:50,099", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
___________ ERROR at setup of TestAccountService.test_list_accounts ____________
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$eofGmXiiirH3wHs1RfsfzA$CY13S3kJlGBnhO2v+6Mn71B5CRJNhak1i+rqm5eYtiU', None, True, False, None, UUID('6bf9e9c7-3969-4af4-b421-f041a65bb64c'), datetime.datetime(2025, 11, 26, 10, 9, 50, 514517, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 50, 514521, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:50,438", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_____ ERROR at setup of TestAccountService.test_list_accounts_with_filters _____
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$1wNjWSmYSu/4kRvv+l4Geg$pIi+JLG7yIoniCwf+ahxeGbDlTnbxzncWMQtG2sfM2M', None, True, False, None, UUID('170a6741-c498-46d0-a491-d6252d8fa3ef'), datetime.datetime(2025, 11, 26, 10, 9, 50, 937331, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 50, 937335, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:50,862", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
______ ERROR at setup of TestAccountService.test_list_accounts_pagination ______
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$0KD9TWv5vftdBZjwFlEmpg$o+Ktx3500JMPAwKZAtepgojr5z2ndqHsxtsih66VSGE', None, True, False, None, UUID('472b245f-19ff-4f34-b15c-94bf8cd7d025'), datetime.datetime(2025, 11, 26, 10, 9, 51, 282643, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 51, 282646, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:51,210", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
____ ERROR at setup of TestAccountService.test_list_accounts_limit_enforced ____
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$Gyd7i+znrC7c8ccbz8zUDA$NYdoMeLKOpRrPFa1iVWd6VXQdhsA5gU7qarcHD9B9zA', None, True, False, None, UUID('cbf7c3e9-d327-465e-b5fe-1b841e019eae'), datetime.datetime(2025, 11, 26, 10, 9, 51, 628039, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 51, 628043, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:51,554", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
________ ERROR at setup of TestAccountService.test_update_account_name _________
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$XjXn+Qm6VRmGmU4TcG7sAA$WSGFSZ+r70+x9D5DNIfAT4u/A4V3SASpUhJ5L4026O4', None, True, False, None, UUID('ac0fbf2d-d73e-419b-b7e1-b16c21789b0a'), datetime.datetime(2025, 11, 26, 10, 9, 51, 969829, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 51, 969833, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:51,900", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
______ ERROR at setup of TestAccountService.test_update_account_is_active ______
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$qJEXV1yqt1DVcM3nKOYsoQ$bBdY48IJlYXAIVEQbrN5Uc/wYcNH4Zx0X9cm7WbxxzA', None, True, False, None, UUID('daba90cf-aa0b-4295-aca3-6bdb5061cc67'), datetime.datetime(2025, 11, 26, 10, 9, 52, 300806, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 52, 300810, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:52,237", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
___ ERROR at setup of TestAccountService.test_update_account_duplicate_name ____
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$WhCeE0hDtd5yGq0XF8XPhw$OM2KUXRGWjfTLaAOYHydTvT+hbhUBGBKBMrhFa1BAos', None, True, False, None, UUID('82b6c536-7083-406a-a176-8cf49c408ceb'), datetime.datetime(2025, 11, 26, 10, 9, 52, 651301, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 52, 651305, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:52,571", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_____ ERROR at setup of TestAccountService.test_update_account_no_changes ______
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$CSxildmHtmA+PXAp/VZEwQ$iCoyqbFZbFS+wEU/7Twm33IDOuGg+BRXA5bZCHsDXt8', None, True, False, None, UUID('df7d2844-fac5-499d-b160-9f9cc75917f8'), datetime.datetime(2025, 11, 26, 10, 9, 52, 993093, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 52, 993098, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:52,917", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
___________ ERROR at setup of TestAccountService.test_delete_account ___________
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$pHsskl/Q5FlbLKqML9zd/Q$Xw9apNHfi6yexyfkr8JnPnnIaRwT3xwfi49Jcz4C0xY', None, True, False, None, UUID('e9a05e1f-6bf0-46bd-8bcf-eecae6b1a909'), datetime.datetime(2025, 11, 26, 10, 9, 53, 330303, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 53, 330307, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:53,266", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
______ ERROR at setup of TestAccountService.test_delete_account_not_owner ______
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$THszg15pMSEaUxEFrazp9Q$QSB2hOwj+irB8S6hrofi10j1CiTW9dbjwnvorBeqA3Q', None, True, False, None, UUID('26dbc603-344c-493d-b8ff-463389dec501'), datetime.datetime(2025, 11, 26, 10, 9, 53, 672411, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 53, 672415, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:53,596", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
________ ERROR at setup of TestAccountService.test_count_user_accounts _________
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$bCnSuS3xqrjZnN12+OTuLw$2FZLgDLok0ixv7m7qRXM4GTauvaU/7lu8TLgqS4Teiw', None, True, False, None, UUID('8ee5e3be-eb15-411b-abc7-0bf09ae77023'), datetime.datetime(2025, 11, 26, 10, 9, 54, 21421, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 54, 21426, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:53,945", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_ ERROR at setup of TestTransactionServiceCreate.test_create_transaction_success _
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$O8doCrbpynAYnQaGFEUnUg$XtfdSkBRXjddU4b8Ch+Hyv6t1mFrKBPo/eWAKd5LpPs', None, True, False, None, UUID('3dc087f5-a390-4100-9139-fd6a2f37af91'), datetime.datetime(2025, 11, 26, 10, 9, 54, 816736, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 54, 816742, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:54,737", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_ ERROR at setup of TestTransactionServiceCreate.test_create_transaction_updates_balance _
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$h0BA2/sMymNx0WJIZShuAg$ksEtQpsOxDGe4okLpxrFYXXErNX/iJWLQ8bTMLGru+Q', None, True, False, None, UUID('9f280dfb-43f3-43d2-8671-bd00055d8ac7'), datetime.datetime(2025, 11, 26, 10, 9, 55, 166737, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 55, 166740, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:55,075", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_ ERROR at setup of TestTransactionServiceCreate.test_create_transaction_currency_mismatch _
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$MCNXEUeuGqojDmwHbE22Vg$lF1Dmf71VreJxVcZNJnKJ4eGzhCBmBdhTn3stdppzto', None, True, False, None, UUID('ad76856b-4c91-4dc9-96ba-be31b335df13'), datetime.datetime(2025, 11, 26, 10, 9, 55, 485825, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 55, 485829, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:55,424", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_ ERROR at setup of TestTransactionServiceCreate.test_create_transaction_zero_amount _
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$iuh1A1uZ0Gt2kLYNoj4H4g$cCvdF5cm0Y80vVMDPx+8UsTHsPtXzzZp9+fLODi7cug', None, True, False, None, UUID('902523c0-74cd-457c-a3ba-2a5082fd21c6'), datetime.datetime(2025, 11, 26, 10, 9, 55, 823132, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 55, 823141, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:55,748", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_ ERROR at setup of TestTransactionServiceCreate.test_create_transaction_permission_denied _
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$ecJz4703uuNE/kPkVTmk3Q$MxWIbgebLMn7az1Ci+Oc2o4fdoMiflusyCdKRUzZgaI', None, True, False, None, UUID('c5089140-2784-4b7c-b883-293bbd2d4630'), datetime.datetime(2025, 11, 26, 10, 9, 56, 152754, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 56, 152760, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:56,080", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
__ ERROR at setup of TestTransactionServiceRead.test_get_transaction_success ___
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$vs7s7EJcjWUjxm4qt9mmDQ$bfXi5amqR8OMesys6fb3V7rNwjX1iT0xpg05hxKiTMQ', None, True, False, None, UUID('d30e96c9-ff79-4836-a09a-5af4abfbb67a'), datetime.datetime(2025, 11, 26, 10, 9, 56, 473962, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 56, 473967, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:56,406", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_ ERROR at setup of TestTransactionServiceRead.test_get_transaction_not_found __
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$w9irJQLbXwHmmYzomHy1+Q$m8gYpE/SOYDzG8NiuLZghONnT8lbihBQnNJakxu785A', None, True, False, None, UUID('64446e73-b26f-4171-93c2-982f08abcdd6'), datetime.datetime(2025, 11, 26, 10, 9, 56, 810509, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 56, 810513, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:56,731", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_ ERROR at setup of TestTransactionServiceRead.test_get_transaction_permission_denied _
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$0+9/KkA2WI8K2Drzd4EMnw$AhDq1ObbkcMS5Jk9lygavr0cqIfylHt48+1jGAZ1MGM', None, True, False, None, UUID('38405709-94c6-420b-bcdc-c7533ee9884c'), datetime.datetime(2025, 11, 26, 10, 9, 57, 145158, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 57, 145162, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:57,068", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
____ ERROR at setup of TestTransactionServiceRead.test_search_transactions _____
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$KC4LNf2Mbr8pavVZKAYlTQ$/r/wWQAnYKoQk8as5bWrdsZBqfnTQtYxJS9Zx1XWElo', None, True, False, None, UUID('d02ba12b-0525-463b-bfa6-9d166ba4a1f5'), datetime.datetime(2025, 11, 26, 10, 9, 57, 489838, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 57, 489842, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:57,404", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_ ERROR at setup of TestTransactionServiceUpdate.test_update_transaction_success _
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$dD4uL76OyaOLY/FH4ULZew$sSoQYrjGGvVUNuqJMwIWSHVBYnJtrqWl4UQgri0kSBA', None, True, False, None, UUID('83775c3a-243a-4570-b052-df1de9f293ab'), datetime.datetime(2025, 11, 26, 10, 9, 57, 815487, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 57, 815491, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:57,741", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_ ERROR at setup of TestTransactionServiceUpdate.test_update_transaction_balance_delta _
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$H8nm9HqTMmISBW3Bk3WsKA$EtOy5cE5UHQwfbSolkR6m0yhNK6JYoLEg7/2T86ntRI', None, True, False, None, UUID('0ba470e0-7434-4622-9f61-0f6418b4d2e3'), datetime.datetime(2025, 11, 26, 10, 9, 58, 174491, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 58, 174495, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:58,071", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_ ERROR at setup of TestTransactionServiceUpdate.test_update_transaction_zero_amount _
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$UfQsnvPhVksNH2iN8O84Iw$SK4KT3rDZbqWwU1GSKwHZhTftMWUdh1RuCoTkdwMxwc', None, True, False, None, UUID('95769420-9cc5-4c9a-8717-892531f843a8'), datetime.datetime(2025, 11, 26, 10, 9, 58, 564628, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 58, 564636, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:58,493", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_ ERROR at setup of TestTransactionServiceUpdate.test_update_transaction_permission_denied _
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$kaC3grW3j+Ha4oJJDsJQbQ$i7eDPW/18Y0EINzROtuy6DgCOU28Fklfjf735nPyvzg', None, True, False, None, UUID('1c532d7f-24fc-4e21-a844-80f27ecc8417'), datetime.datetime(2025, 11, 26, 10, 9, 58, 890857, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 58, 890861, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:58,818", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_ ERROR at setup of TestTransactionServiceDelete.test_delete_transaction_success _
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$2f+JObRNEpOfZpOMXbsF3g$eU+aMMC27c2CU6CdAaMJET1a9wkF2+nrl0SV8XXnu0Y', None, True, False, None, UUID('df4db536-8ccd-4782-b04d-e04f587ec6e5'), datetime.datetime(2025, 11, 26, 10, 9, 59, 217578, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 59, 217583, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:59,148", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_ ERROR at setup of TestTransactionServiceDelete.test_delete_transaction_updates_balance _
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$ei4YE0WjlmKuDaTgfGFUOg$lBSI8Q4SK91mpK7624D+MRKJAz52VaezxBNVlpXt9JE', None, True, False, None, UUID('bebb5b6c-d7da-4857-a589-593a15f2dd86'), datetime.datetime(2025, 11, 26, 10, 9, 59, 539288, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 59, 539292, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:59,473", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_ ERROR at setup of TestTransactionServiceDelete.test_delete_parent_deletes_children _
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$FqMPdqdu/VE5Yywopl0kng$wlx2F+YzfdW2GZu8gj6WaIxhsq8/uS8KU3Ki/cOzAxw', None, True, False, None, UUID('d5758fbc-9f92-46f6-92f7-439845abde99'), datetime.datetime(2025, 11, 26, 10, 9, 59, 869417, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 9, 59, 869421, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:59,799", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_ ERROR at setup of TestTransactionServiceSplit.test_split_transaction_success _
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$zUMrosORns6ws+h3VeEnQw$1qRobpmxob8JGRjHVrurz6Mscng7WLdsvC3xN+7yiG4', None, True, False, None, UUID('1c1963c3-bac1-4c75-a523-4d09c9fffdad'), datetime.datetime(2025, 11, 26, 10, 10, 0, 206469, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 10, 0, 206474, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:10:00,127", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_ ERROR at setup of TestTransactionServiceSplit.test_split_transaction_amounts_must_sum _
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$//vA7fXH09vda2c2/I6APQ$mAPNvfNJ+fptdJUlUpiIvXLqSczlsCblLo94G35PypE', None, True, False, None, UUID('6cb758a7-c889-4e5a-8f53-364d1208f3db'), datetime.datetime(2025, 11, 26, 10, 10, 0, 540462, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 10, 0, 540466, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:10:00,466", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_ ERROR at setup of TestTransactionServiceSplit.test_split_requires_minimum_two_splits _
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$7PUGMOQoUd3MFhBzncTO/w$s/jba9NSkXNXTvw8kSFX/lFcRfA7g37qa7IvWGWra/g', None, True, False, None, UUID('0bfa5aa9-73f6-4887-8e89-44b197d10324'), datetime.datetime(2025, 11, 26, 10, 10, 0, 877963, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 10, 0, 877967, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:10:00,793", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_ ERROR at setup of TestTransactionServiceSplit.test_cannot_split_child_transaction _
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$UG9zPPf3hPZMDdmC3SsFZQ$hVHQAmm0iwOJ8wv606LT5pB2RvE9MBVa8OmUhUfeYZY', None, True, False, None, UUID('37de01f9-27e3-4d83-bec5-4bffd57256a5'), datetime.datetime(2025, 11, 26, 10, 10, 1, 208168, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 10, 1, 208172, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:10:01,142", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
__ ERROR at setup of TestTransactionServiceSplit.test_join_split_transaction ___
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$w7aHA4DY/vEU/QLa9eSd1Q$nrNhbcRgjORk7U1n0rzxtrKvLkyeoRQvaQNoTWBvJrA', None, True, False, None, UUID('e5249a1d-5e65-4ffd-9125-294bd08b7500'), datetime.datetime(2025, 11, 26, 10, 10, 1, 535756, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 10, 1, 535760, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:10:01,460", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
___ ERROR at setup of TestTransactionServiceSplit.test_join_requires_splits ____
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$8jo5Kwnd+NXN9yW893tw9g$4vLcwHj2rbWxe9EjQmwsBCvkqHnr2EsMomonyJg4FKs', None, True, False, None, UUID('f1a5fb4a-65f4-48b0-9bb0-c7e437ab89f5'), datetime.datetime(2025, 11, 26, 10, 10, 1, 869851, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 10, 1, 869855, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:10:01,792", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
______ ERROR at setup of TestTransactionServiceTags.test_add_tag_success _______
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$zRJgcAuP4gvi3Ox/u4pr5Q$vBGcNZobIZrCfclFfdnAbf05h/Rr5sOzdQIiXjYPpPo', None, True, False, None, UUID('55d0ba93-5aab-4b8f-b120-6b35cba76001'), datetime.datetime(2025, 11, 26, 10, 10, 2, 262300, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 10, 2, 262304, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:10:02,192", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_____ ERROR at setup of TestTransactionServiceTags.test_remove_tag_success _____
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$Vmjt3ZZ5LQfcD3pmtI1grA$6vOpdUJwIbKHHpdFMzvx6OaojBFUVc48ZWXvyqCiJ4k', None, True, False, None, UUID('34edaf1a-5bb4-4c16-8463-1bf96b6ed9c0'), datetime.datetime(2025, 11, 26, 10, 10, 2, 598773, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 10, 2, 598778, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:10:02,527", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
___ ERROR at setup of TestTransactionServiceTags.test_tag_permission_denied ____
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:550: in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
    data, status, _ = await self.__do_execute(
.venv/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
asyncpg/protocol/protocol.pyx:206: in bind_execute
    ???
E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.

The above exception was the direct cause of the following exception:
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:463: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
                  ^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:366: in _async_fixture_wrapper
    result = runner.run(setup(), context=context)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py:720: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:362: in setup
    res = await fixture_function(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/conftest.py:251: in test_user
    await session.commit()
.venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:585: in execute
    self._adapt_connection.await_(
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:563: in _prepare_and_execute
    self._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:513: in _handle_exception
    self._adapt_connection._handle_exception(error)
.venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:797: in _handle_exception
    raise translated_error from error
E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(testuser@example.com) already exists.
E   [SQL: INSERT INTO users (username, email, password_hash, full_name, is_active, is_admin, last_login_at, id, created_at, updated_at, deleted_at, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE, $12::UUID, $13::UUID)]
E   [parameters: ('testuser', 'testuser@example.com', '$argon2id$v=19$m=65536,t=2,p=4$eZEmgHe/X2I3ZX/17Bniog$dRPtIyPSldvZPYYE146SOX+4em6SRln636s7FU/bvX0', None, True, False, None, UUID('5ecc2b22-1500-4ed6-8dc3-f1cf195f2529'), datetime.datetime(2025, 11, 26, 10, 10, 2, 927456, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 11, 26, 10, 10, 2, 927460, tzinfo=datetime.timezone.utc), None, None, None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:10:02,853", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
=================================== FAILURES ===================================
_________________ test_account_sharing_collaboration_workflow __________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/e2e/test_collaboration_workflow.py", line 88, in test_account_sharing_collaboration_workflow
    |     share_response = await async_client.post(
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<13 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/e2e/test_collaboration_workflow.py", line 88, in test_account_sharing_collaboration_workflow
    share_response = await async_client.post(
                     ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/e2e/test_collaboration_workflow.py:88: in test_account_sharing_collaboration_workflow
    share_response = await async_client.post(
.venv/lib/python3.13/site-packages/httpx/_client.py:1859: in post
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:08:47,951", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:47,952", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:47,952", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,195", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:08:48,299", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 135, "funcName": "register", "message": "User registered successfully: 4876ed0c-362b-4fdf-af1f-383636f66f6e (usera@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,338", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=4876ed0c-362b-4fdf-af1f-383636f66f6e, action=CREATE, entity=user:4876ed0c-362b-4fdf-af1f-383636f66f6e, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,341", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 117, "funcName": "register", "message": "User registered: 4876ed0c-362b-4fdf-af1f-383636f66f6e (usera@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,341", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/register 201 - request_id=unknown client=127.0.0.1 duration=0.122s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,342", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/register \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,395", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 4876ed0c-362b-4fdf-af1f-383636f66f6e (usera@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,430", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=4876ed0c-362b-4fdf-af1f-383636f66f6e, action=LOGIN, entity=user:4876ed0c-362b-4fdf-af1f-383636f66f6e, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,433", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 4876ed0c-362b-4fdf-af1f-383636f66f6e (usera@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,433", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.091s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,434", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,479", "name": "src.services.account_service", "levelname": "INFO", "filename": "account_service.py", "lineno": 174, "funcName": "create_account", "message": "Created account 0972c985-245a-424d-8b86-312c733c32b0 (Shared Savings) for user 4876ed0c-362b-4fdf-af1f-383636f66f6e", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,485", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=4876ed0c-362b-4fdf-af1f-383636f66f6e, action=CREATE, entity=account:0972c985-245a-424d-8b86-312c733c32b0, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,485", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/v1/accounts 201 - request_id=unknown client=127.0.0.1 duration=0.051s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,489", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
 Step 1: User A created savings account ($5000.00)
{"asctime": "2025-11-26 10:08:48,541", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 135, "funcName": "register", "message": "User registered successfully: 0836f347-e5b4-4855-83be-907ca31e719e (userb@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,578", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=0836f347-e5b4-4855-83be-907ca31e719e, action=CREATE, entity=user:0836f347-e5b4-4855-83be-907ca31e719e, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,580", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 117, "funcName": "register", "message": "User registered: 0836f347-e5b4-4855-83be-907ca31e719e (userb@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,581", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/register 201 - request_id=unknown client=127.0.0.1 duration=0.092s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,581", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/register \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,635", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 0836f347-e5b4-4855-83be-907ca31e719e (userb@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,669", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=0836f347-e5b4-4855-83be-907ca31e719e, action=LOGIN, entity=user:0836f347-e5b4-4855-83be-907ca31e719e, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,672", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 0836f347-e5b4-4855-83be-907ca31e719e (userb@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,672", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.091s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,673", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,698", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: POST /api/v1/accounts/0972c985-245a-424d-8b86-312c733c32b0/shares - request_id=unknown client=127.0.0.1 duration=0.025s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:48,717", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=8cfdd633-7789-4466-913b-407660f69007)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/register "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/register "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
______________________ test_permission_downgrade_workflow ______________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/e2e/test_collaboration_workflow.py", line 265, in test_permission_downgrade_workflow
    |     share_response = await async_client.post(
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<13 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/e2e/test_collaboration_workflow.py", line 265, in test_permission_downgrade_workflow
    share_response = await async_client.post(
                     ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/e2e/test_collaboration_workflow.py:265: in test_permission_downgrade_workflow
    share_response = await async_client.post(
.venv/lib/python3.13/site-packages/httpx/_client.py:1859: in post
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:08:49,071", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:08:49,143", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 135, "funcName": "register", "message": "User registered successfully: 8624a7e4-8141-44c4-8370-7d99055650d1 (owner@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,180", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=8624a7e4-8141-44c4-8370-7d99055650d1, action=CREATE, entity=user:8624a7e4-8141-44c4-8370-7d99055650d1, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,183", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 117, "funcName": "register", "message": "User registered: 8624a7e4-8141-44c4-8370-7d99055650d1 (owner@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,183", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/register 201 - request_id=unknown client=127.0.0.1 duration=0.096s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,184", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/register \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,234", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 8624a7e4-8141-44c4-8370-7d99055650d1 (owner@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,267", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=8624a7e4-8141-44c4-8370-7d99055650d1, action=LOGIN, entity=user:8624a7e4-8141-44c4-8370-7d99055650d1, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,269", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 8624a7e4-8141-44c4-8370-7d99055650d1 (owner@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,275", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.091s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,276", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,326", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 135, "funcName": "register", "message": "User registered successfully: c5650810-51eb-4622-a9d7-51e53b8c85fb (editor@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,359", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=c5650810-51eb-4622-a9d7-51e53b8c85fb, action=CREATE, entity=user:c5650810-51eb-4622-a9d7-51e53b8c85fb, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,362", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 117, "funcName": "register", "message": "User registered: c5650810-51eb-4622-a9d7-51e53b8c85fb (editor@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,370", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/register 201 - request_id=unknown client=127.0.0.1 duration=0.094s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,371", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/register \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,420", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: c5650810-51eb-4622-a9d7-51e53b8c85fb (editor@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,453", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=c5650810-51eb-4622-a9d7-51e53b8c85fb, action=LOGIN, entity=user:c5650810-51eb-4622-a9d7-51e53b8c85fb, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,464", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: c5650810-51eb-4622-a9d7-51e53b8c85fb (editor@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,464", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.093s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,465", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,504", "name": "src.services.account_service", "levelname": "INFO", "filename": "account_service.py", "lineno": 174, "funcName": "create_account", "message": "Created account 8aa7256e-7efa-4e19-abf0-e9ec4c88a577 (Downgrade Test) for user 8624a7e4-8141-44c4-8370-7d99055650d1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,511", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=8624a7e4-8141-44c4-8370-7d99055650d1, action=CREATE, entity=account:8aa7256e-7efa-4e19-abf0-e9ec4c88a577, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,511", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/v1/accounts 201 - request_id=unknown client=127.0.0.1 duration=0.046s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,515", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,541", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: POST /api/v1/accounts/8aa7256e-7efa-4e19-abf0-e9ec4c88a577/shares - request_id=unknown client=127.0.0.1 duration=0.025s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,555", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=40d322e9-2e6d-4a36-91eb-c3a3412ef9a3)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/register "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/register "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts "HTTP/1.1 201 Created"
__________________ test_shared_account_transaction_visibility __________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/e2e/test_collaboration_workflow.py", line 380, in test_shared_account_transaction_visibility
    |     await async_client.post(
    |     ...<6 lines>...
    |     )
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<13 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/e2e/test_collaboration_workflow.py", line 380, in test_shared_account_transaction_visibility
    await async_client.post(
    ...<6 lines>...
    )
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/e2e/test_collaboration_workflow.py:380: in test_shared_account_transaction_visibility
    await async_client.post(
.venv/lib/python3.13/site-packages/httpx/_client.py:1859: in post
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:08:49,843", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:08:49,914", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 135, "funcName": "register", "message": "User registered successfully: fe09caca-09da-484e-98c6-1a4f455e783b (sharer@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,948", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=fe09caca-09da-484e-98c6-1a4f455e783b, action=CREATE, entity=user:fe09caca-09da-484e-98c6-1a4f455e783b, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,950", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 117, "funcName": "register", "message": "User registered: fe09caca-09da-484e-98c6-1a4f455e783b (sharer@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,951", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/register 201 - request_id=unknown client=127.0.0.1 duration=0.091s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:49,951", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/register \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,000", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: fe09caca-09da-484e-98c6-1a4f455e783b (sharer@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,037", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=fe09caca-09da-484e-98c6-1a4f455e783b, action=LOGIN, entity=user:fe09caca-09da-484e-98c6-1a4f455e783b, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,040", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: fe09caca-09da-484e-98c6-1a4f455e783b (sharer@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,040", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.089s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,041", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,092", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 135, "funcName": "register", "message": "User registered successfully: 3e42e7cd-ab8f-4d8d-88f9-82ec5ec985a1 (viewer@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,124", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=3e42e7cd-ab8f-4d8d-88f9-82ec5ec985a1, action=CREATE, entity=user:3e42e7cd-ab8f-4d8d-88f9-82ec5ec985a1, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,127", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 117, "funcName": "register", "message": "User registered: 3e42e7cd-ab8f-4d8d-88f9-82ec5ec985a1 (viewer@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,127", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/register 201 - request_id=unknown client=127.0.0.1 duration=0.086s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,127", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/register \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,176", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 3e42e7cd-ab8f-4d8d-88f9-82ec5ec985a1 (viewer@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,208", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=3e42e7cd-ab8f-4d8d-88f9-82ec5ec985a1, action=LOGIN, entity=user:3e42e7cd-ab8f-4d8d-88f9-82ec5ec985a1, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,211", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 3e42e7cd-ab8f-4d8d-88f9-82ec5ec985a1 (viewer@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,211", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.083s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,212", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,256", "name": "src.services.account_service", "levelname": "INFO", "filename": "account_service.py", "lineno": 174, "funcName": "create_account", "message": "Created account bf2647cb-3aae-4542-aec4-624325fc87cd (Visibility Test) for user fe09caca-09da-484e-98c6-1a4f455e783b", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,262", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=fe09caca-09da-484e-98c6-1a4f455e783b, action=CREATE, entity=account:bf2647cb-3aae-4542-aec4-624325fc87cd, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,262", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/v1/accounts 201 - request_id=unknown client=127.0.0.1 duration=0.050s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,265", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,290", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=69116bb3-d4d6-455a-acd5-34a07157cc9e)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,290", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/bf2647cb-3aae-4542-aec4-624325fc87cd/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.025s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,291", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/bf2647cb-3aae-4542-aec4-624325fc87cd/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,314", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=c2aba01c-e857-4868-bf3c-50aac40a1718)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,315", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/bf2647cb-3aae-4542-aec4-624325fc87cd/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.023s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,315", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/bf2647cb-3aae-4542-aec4-624325fc87cd/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,341", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=b4adf2f2-bbf6-48c3-aa7e-f0c8f52d95fb)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,341", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/bf2647cb-3aae-4542-aec4-624325fc87cd/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.026s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,342", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/bf2647cb-3aae-4542-aec4-624325fc87cd/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,366", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: POST /api/v1/accounts/bf2647cb-3aae-4542-aec4-624325fc87cd/shares - request_id=unknown client=127.0.0.1 duration=0.024s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,379", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=23cbfe0c-eb8a-412b-9a5c-43f6135e7c65)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/register "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/register "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/bf2647cb-3aae-4542-aec4-624325fc87cd/transactions "HTTP/1.1 422 Unprocessable Entity"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/bf2647cb-3aae-4542-aec4-624325fc87cd/transactions "HTTP/1.1 422 Unprocessable Entity"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/bf2647cb-3aae-4542-aec4-624325fc87cd/transactions "HTTP/1.1 422 Unprocessable Entity"
__________________________ test_share_list_visibility __________________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/e2e/test_collaboration_workflow.py", line 454, in test_share_list_visibility
    |     await async_client.post(
    |     ...<3 lines>...
    |     )
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<13 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/e2e/test_collaboration_workflow.py", line 454, in test_share_list_visibility
    await async_client.post(
    ...<3 lines>...
    )
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/e2e/test_collaboration_workflow.py:454: in test_share_list_visibility
    await async_client.post(
.venv/lib/python3.13/site-packages/httpx/_client.py:1859: in post
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:08:50,665", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:08:50,740", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 135, "funcName": "register", "message": "User registered successfully: d0e69dc4-6420-41b3-b463-bee3ceb22c22 (owner@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,777", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=d0e69dc4-6420-41b3-b463-bee3ceb22c22, action=CREATE, entity=user:d0e69dc4-6420-41b3-b463-bee3ceb22c22, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,780", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 117, "funcName": "register", "message": "User registered: d0e69dc4-6420-41b3-b463-bee3ceb22c22 (owner@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,780", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/register 201 - request_id=unknown client=127.0.0.1 duration=0.100s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,781", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/register \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,829", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: d0e69dc4-6420-41b3-b463-bee3ceb22c22 (owner@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,861", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=d0e69dc4-6420-41b3-b463-bee3ceb22c22, action=LOGIN, entity=user:d0e69dc4-6420-41b3-b463-bee3ceb22c22, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,864", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: d0e69dc4-6420-41b3-b463-bee3ceb22c22 (owner@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,864", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.083s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,864", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,920", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 135, "funcName": "register", "message": "User registered successfully: f93dcecf-58fc-4513-a7df-9a2225af61e4 (editor@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,953", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=f93dcecf-58fc-4513-a7df-9a2225af61e4, action=CREATE, entity=user:f93dcecf-58fc-4513-a7df-9a2225af61e4, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,956", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 117, "funcName": "register", "message": "User registered: f93dcecf-58fc-4513-a7df-9a2225af61e4 (editor@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,956", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/register 201 - request_id=unknown client=127.0.0.1 duration=0.091s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:50,956", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/register \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,006", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: f93dcecf-58fc-4513-a7df-9a2225af61e4 (editor@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,040", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=f93dcecf-58fc-4513-a7df-9a2225af61e4, action=LOGIN, entity=user:f93dcecf-58fc-4513-a7df-9a2225af61e4, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,043", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: f93dcecf-58fc-4513-a7df-9a2225af61e4 (editor@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,043", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.087s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,044", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,097", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 135, "funcName": "register", "message": "User registered successfully: fd4808e2-120c-4a69-8852-1fdf27d1aab6 (viewer@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,131", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=fd4808e2-120c-4a69-8852-1fdf27d1aab6, action=CREATE, entity=user:fd4808e2-120c-4a69-8852-1fdf27d1aab6, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,134", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 117, "funcName": "register", "message": "User registered: fd4808e2-120c-4a69-8852-1fdf27d1aab6 (viewer@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,134", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/register 201 - request_id=unknown client=127.0.0.1 duration=0.090s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,134", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/register \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,187", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: fd4808e2-120c-4a69-8852-1fdf27d1aab6 (viewer@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,220", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=fd4808e2-120c-4a69-8852-1fdf27d1aab6, action=LOGIN, entity=user:fd4808e2-120c-4a69-8852-1fdf27d1aab6, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,222", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: fd4808e2-120c-4a69-8852-1fdf27d1aab6 (viewer@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,223", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.088s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,223", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,265", "name": "src.services.account_service", "levelname": "INFO", "filename": "account_service.py", "lineno": 174, "funcName": "create_account", "message": "Created account 79752f56-23e9-461d-82db-62637420cc5b (Share List Test) for user d0e69dc4-6420-41b3-b463-bee3ceb22c22", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,272", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=d0e69dc4-6420-41b3-b463-bee3ceb22c22, action=CREATE, entity=account:79752f56-23e9-461d-82db-62637420cc5b, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,272", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/v1/accounts 201 - request_id=unknown client=127.0.0.1 duration=0.049s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,276", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,301", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: POST /api/v1/accounts/79752f56-23e9-461d-82db-62637420cc5b/shares - request_id=unknown client=127.0.0.1 duration=0.025s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,314", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=18451530-2ceb-41eb-9d2f-09df57a71821)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/register "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/register "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/register "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts "HTTP/1.1 201 Created"
_______________________ test_cascading_share_revocation ________________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/e2e/test_collaboration_workflow.py", line 543, in test_cascading_share_revocation
    |     await async_client.post(
    |     ...<3 lines>...
    |     )
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<13 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/e2e/test_collaboration_workflow.py", line 543, in test_cascading_share_revocation
    await async_client.post(
    ...<3 lines>...
    )
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/e2e/test_collaboration_workflow.py:543: in test_cascading_share_revocation
    await async_client.post(
.venv/lib/python3.13/site-packages/httpx/_client.py:1859: in post
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:08:51,589", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:08:51,659", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 135, "funcName": "register", "message": "User registered successfully: 26903145-32a2-4a9b-bcc5-df83ccf6dc1f (deleter@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,693", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=26903145-32a2-4a9b-bcc5-df83ccf6dc1f, action=CREATE, entity=user:26903145-32a2-4a9b-bcc5-df83ccf6dc1f, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,696", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 117, "funcName": "register", "message": "User registered: 26903145-32a2-4a9b-bcc5-df83ccf6dc1f (deleter@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,696", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/register 201 - request_id=unknown client=127.0.0.1 duration=0.092s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,697", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/register \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,746", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 26903145-32a2-4a9b-bcc5-df83ccf6dc1f (deleter@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,786", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=26903145-32a2-4a9b-bcc5-df83ccf6dc1f, action=LOGIN, entity=user:26903145-32a2-4a9b-bcc5-df83ccf6dc1f, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,791", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 26903145-32a2-4a9b-bcc5-df83ccf6dc1f (deleter@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,792", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.095s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,792", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,845", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 135, "funcName": "register", "message": "User registered successfully: 8016e4bc-bddb-41e4-b899-deaf88c5f39d (sharee@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,886", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=8016e4bc-bddb-41e4-b899-deaf88c5f39d, action=CREATE, entity=user:8016e4bc-bddb-41e4-b899-deaf88c5f39d, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,889", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 117, "funcName": "register", "message": "User registered: 8016e4bc-bddb-41e4-b899-deaf88c5f39d (sharee@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,889", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/register 201 - request_id=unknown client=127.0.0.1 duration=0.097s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,890", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/register \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,939", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 8016e4bc-bddb-41e4-b899-deaf88c5f39d (sharee@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,974", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=8016e4bc-bddb-41e4-b899-deaf88c5f39d, action=LOGIN, entity=user:8016e4bc-bddb-41e4-b899-deaf88c5f39d, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,977", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 8016e4bc-bddb-41e4-b899-deaf88c5f39d (sharee@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,977", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.087s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:51,978", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,020", "name": "src.services.account_service", "levelname": "INFO", "filename": "account_service.py", "lineno": 174, "funcName": "create_account", "message": "Created account bc238ed5-7cda-46fd-ad25-d2607d70b8b3 (To Delete) for user 26903145-32a2-4a9b-bcc5-df83ccf6dc1f", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,026", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=26903145-32a2-4a9b-bcc5-df83ccf6dc1f, action=CREATE, entity=account:bc238ed5-7cda-46fd-ad25-d2607d70b8b3, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,026", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/v1/accounts 201 - request_id=unknown client=127.0.0.1 duration=0.048s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,029", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,054", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: POST /api/v1/accounts/bc238ed5-7cda-46fd-ad25-d2607d70b8b3/shares - request_id=unknown client=127.0.0.1 duration=0.024s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,066", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=d03a9b55-3c21-47b3-8a2a-bea4b7b8d042)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/register "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/register "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts "HTTP/1.1 201 Created"
__________________________ test_complete_user_journey __________________________
tests/e2e/test_user_journey.py:112: in test_complete_user_journey
    assert income_response.status_code == 201
E   assert 422 == 201
E    +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:08:52,343", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:08:52,415", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 135, "funcName": "register", "message": "User registered successfully: c305adfa-ff61-4666-8481-cb590d0624ca (journey@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,449", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=c305adfa-ff61-4666-8481-cb590d0624ca, action=CREATE, entity=user:c305adfa-ff61-4666-8481-cb590d0624ca, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,452", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 117, "funcName": "register", "message": "User registered: c305adfa-ff61-4666-8481-cb590d0624ca (journey@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,452", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/register 201 - request_id=unknown client=127.0.0.1 duration=0.093s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,453", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/register \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
 Step 1: User registered (ID: c305adfa-ff61-4666-8481-cb590d0624ca)
{"asctime": "2025-11-26 10:08:52,501", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: c305adfa-ff61-4666-8481-cb590d0624ca (journey@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,535", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=c305adfa-ff61-4666-8481-cb590d0624ca, action=LOGIN, entity=user:c305adfa-ff61-4666-8481-cb590d0624ca, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,538", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: c305adfa-ff61-4666-8481-cb590d0624ca (journey@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,538", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.085s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,539", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
 Step 2: User logged in and received tokens
{"asctime": "2025-11-26 10:08:52,561", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "GET /api/v1/users/me 200 - request_id=unknown client=127.0.0.1 duration=0.022s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,563", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: GET http://test/api/v1/users/me \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
 Step 3: Retrieved user profile (journeyuser)
{"asctime": "2025-11-26 10:08:52,603", "name": "src.services.account_service", "levelname": "INFO", "filename": "account_service.py", "lineno": 174, "funcName": "create_account", "message": "Created account 8899f980-50f9-4d12-9af9-65df83b665da (Main Checking) for user c305adfa-ff61-4666-8481-cb590d0624ca", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,610", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=c305adfa-ff61-4666-8481-cb590d0624ca, action=CREATE, entity=account:8899f980-50f9-4d12-9af9-65df83b665da, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,611", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/v1/accounts 201 - request_id=unknown client=127.0.0.1 duration=0.047s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,614", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
 Step 4: Created checking account (ID: 8899f980-50f9-4d12-9af9-65df83b665da, Balance: $1000.00)
{"asctime": "2025-11-26 10:08:52,639", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'credit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=8528aca2-4f7c-456b-b805-c3110d0528f4)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,640", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/8899f980-50f9-4d12-9af9-65df83b665da/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.026s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,640", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/8899f980-50f9-4d12-9af9-65df83b665da/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/register "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: GET http://test/api/v1/users/me "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/8899f980-50f9-4d12-9af9-65df83b665da/transactions "HTTP/1.1 422 Unprocessable Entity"
___________ test_new_user_creates_multiple_accounts_and_transactions ___________
tests/e2e/test_user_journey.py:297: in test_new_user_creates_multiple_accounts_and_transactions
    assert checking_txns.json()["total"] == 3
E   assert 0 == 3
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:08:52,740", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:08:52,810", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 135, "funcName": "register", "message": "User registered successfully: 5332a009-99bd-4a51-92b8-c64ee5585f1f (multi@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,852", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=5332a009-99bd-4a51-92b8-c64ee5585f1f, action=CREATE, entity=user:5332a009-99bd-4a51-92b8-c64ee5585f1f, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,855", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 117, "funcName": "register", "message": "User registered: 5332a009-99bd-4a51-92b8-c64ee5585f1f (multi@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,855", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/register 201 - request_id=unknown client=127.0.0.1 duration=0.099s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,856", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/register \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,908", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 5332a009-99bd-4a51-92b8-c64ee5585f1f (multi@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,943", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=5332a009-99bd-4a51-92b8-c64ee5585f1f, action=LOGIN, entity=user:5332a009-99bd-4a51-92b8-c64ee5585f1f, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,946", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 5332a009-99bd-4a51-92b8-c64ee5585f1f (multi@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,946", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.090s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,947", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,987", "name": "src.services.account_service", "levelname": "INFO", "filename": "account_service.py", "lineno": 174, "funcName": "create_account", "message": "Created account a847486f-0442-4d6d-a911-47b992474c10 (Checking) for user 5332a009-99bd-4a51-92b8-c64ee5585f1f", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,994", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=5332a009-99bd-4a51-92b8-c64ee5585f1f, action=CREATE, entity=account:a847486f-0442-4d6d-a911-47b992474c10, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,994", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/v1/accounts 201 - request_id=unknown client=127.0.0.1 duration=0.047s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:52,997", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,038", "name": "src.services.account_service", "levelname": "INFO", "filename": "account_service.py", "lineno": 174, "funcName": "create_account", "message": "Created account d48634a3-f2a9-4d91-9097-0ab7a45fef10 (Savings) for user 5332a009-99bd-4a51-92b8-c64ee5585f1f", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,044", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=5332a009-99bd-4a51-92b8-c64ee5585f1f, action=CREATE, entity=account:d48634a3-f2a9-4d91-9097-0ab7a45fef10, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,045", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/v1/accounts 201 - request_id=unknown client=127.0.0.1 duration=0.047s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,048", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,073", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=11266b45-28f3-4452-9b06-f6768758e009)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,073", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/a847486f-0442-4d6d-a911-47b992474c10/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.025s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,073", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/a847486f-0442-4d6d-a911-47b992474c10/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,099", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=719a0be2-1503-4e24-9788-44e5eee07261)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,099", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/a847486f-0442-4d6d-a911-47b992474c10/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.026s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,100", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/a847486f-0442-4d6d-a911-47b992474c10/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,124", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=69df029d-0d75-4822-b84f-6df137eadd10)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,124", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/a847486f-0442-4d6d-a911-47b992474c10/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.024s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,124", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/a847486f-0442-4d6d-a911-47b992474c10/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,151", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'credit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=b03e6180-7acc-4765-9de8-e3f31e766949)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,152", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/d48634a3-f2a9-4d91-9097-0ab7a45fef10/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.027s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,152", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/d48634a3-f2a9-4d91-9097-0ab7a45fef10/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,195", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "GET /api/v1/accounts 200 - request_id=unknown client=127.0.0.1 duration=0.043s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,198", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: GET http://test/api/v1/accounts \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,257", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "GET /api/v1/accounts/a847486f-0442-4d6d-a911-47b992474c10/transactions 200 - request_id=unknown client=127.0.0.1 duration=0.059s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,261", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: GET http://test/api/v1/accounts/a847486f-0442-4d6d-a911-47b992474c10/transactions \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/register "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/a847486f-0442-4d6d-a911-47b992474c10/transactions "HTTP/1.1 422 Unprocessable Entity"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/a847486f-0442-4d6d-a911-47b992474c10/transactions "HTTP/1.1 422 Unprocessable Entity"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/a847486f-0442-4d6d-a911-47b992474c10/transactions "HTTP/1.1 422 Unprocessable Entity"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/d48634a3-f2a9-4d91-9097-0ab7a45fef10/transactions "HTTP/1.1 422 Unprocessable Entity"
INFO     httpx:_client.py:1740 HTTP Request: GET http://test/api/v1/accounts "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: GET http://test/api/v1/accounts/a847486f-0442-4d6d-a911-47b992474c10/transactions "HTTP/1.1 200 OK"
___________________ test_transaction_tag_management_workflow ___________________
tests/e2e/test_user_journey.py:394: in test_transaction_tag_management_workflow
    txn_id = txn_response.json()["id"]
             ^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'id'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:08:53,697", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:08:53,775", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 135, "funcName": "register", "message": "User registered successfully: 24ac45ed-b943-4c44-9bff-f00f51e77ce8 (tagger@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,814", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=24ac45ed-b943-4c44-9bff-f00f51e77ce8, action=CREATE, entity=user:24ac45ed-b943-4c44-9bff-f00f51e77ce8, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,817", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 117, "funcName": "register", "message": "User registered: 24ac45ed-b943-4c44-9bff-f00f51e77ce8 (tagger@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,817", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/register 201 - request_id=unknown client=127.0.0.1 duration=0.099s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,818", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/register \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,867", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 24ac45ed-b943-4c44-9bff-f00f51e77ce8 (tagger@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,900", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=24ac45ed-b943-4c44-9bff-f00f51e77ce8, action=LOGIN, entity=user:24ac45ed-b943-4c44-9bff-f00f51e77ce8, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,903", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 24ac45ed-b943-4c44-9bff-f00f51e77ce8 (tagger@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,903", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.085s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,903", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,943", "name": "src.services.account_service", "levelname": "INFO", "filename": "account_service.py", "lineno": 174, "funcName": "create_account", "message": "Created account 20bc903c-b4f4-42ea-a1c2-4096ab48f933 (Tag Account) for user 24ac45ed-b943-4c44-9bff-f00f51e77ce8", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,949", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=24ac45ed-b943-4c44-9bff-f00f51e77ce8, action=CREATE, entity=account:20bc903c-b4f4-42ea-a1c2-4096ab48f933, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,949", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/v1/accounts 201 - request_id=unknown client=127.0.0.1 duration=0.045s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,952", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,979", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=e923bf3a-761c-44db-b294-bed59fb66739)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,979", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/20bc903c-b4f4-42ea-a1c2-4096ab48f933/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.027s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:53,980", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/20bc903c-b4f4-42ea-a1c2-4096ab48f933/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/register "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/20bc903c-b4f4-42ea-a1c2-4096ab48f933/transactions "HTTP/1.1 422 Unprocessable Entity"
___________________ test_transaction_split_and_join_workflow ___________________
tests/e2e/test_user_journey.py:477: in test_transaction_split_and_join_workflow
    txn_id = txn_response.json()["id"]
             ^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'id'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:08:54,084", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:08:54,166", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 135, "funcName": "register", "message": "User registered successfully: e2098e25-19aa-420f-bd9f-52cd95337271 (splitter@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:54,200", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=e2098e25-19aa-420f-bd9f-52cd95337271, action=CREATE, entity=user:e2098e25-19aa-420f-bd9f-52cd95337271, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:54,203", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 117, "funcName": "register", "message": "User registered: e2098e25-19aa-420f-bd9f-52cd95337271 (splitter@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:54,203", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/register 201 - request_id=unknown client=127.0.0.1 duration=0.097s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:54,204", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/register \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:54,254", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: e2098e25-19aa-420f-bd9f-52cd95337271 (splitter@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:54,289", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=e2098e25-19aa-420f-bd9f-52cd95337271, action=LOGIN, entity=user:e2098e25-19aa-420f-bd9f-52cd95337271, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:54,292", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: e2098e25-19aa-420f-bd9f-52cd95337271 (splitter@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:54,292", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.088s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:54,293", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:54,335", "name": "src.services.account_service", "levelname": "INFO", "filename": "account_service.py", "lineno": 174, "funcName": "create_account", "message": "Created account 083d6ace-1927-414c-baf7-2d838391411f (Split Account) for user e2098e25-19aa-420f-bd9f-52cd95337271", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:54,341", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=e2098e25-19aa-420f-bd9f-52cd95337271, action=CREATE, entity=account:083d6ace-1927-414c-baf7-2d838391411f, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:54,341", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/v1/accounts 201 - request_id=unknown client=127.0.0.1 duration=0.048s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:54,344", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:54,368", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=5cfe6db2-2f44-46d0-8b54-fe784bbe6561)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:54,369", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/083d6ace-1927-414c-baf7-2d838391411f/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.024s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:54,369", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/083d6ace-1927-414c-baf7-2d838391411f/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/register "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/083d6ace-1927-414c-baf7-2d838391411f/transactions "HTTP/1.1 422 Unprocessable Entity"
____________ TestAccountRoutes.test_create_account_negative_balance ____________
tests/integration/test_account_routes.py:72: in test_create_account_negative_balance
    assert response.status_code == 201
E   assert 422 == 201
E    +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:08:55,414", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:55,547", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: b46dfde7-ed29-40dd-8bd1-fc945dccb371 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:55,583", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=b46dfde7-ed29-40dd-8bd1-fc945dccb371, action=LOGIN, entity=user:b46dfde7-ed29-40dd-8bd1-fc945dccb371, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:55,585", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: b46dfde7-ed29-40dd-8bd1-fc945dccb371 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:55,586", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.089s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:55,586", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:08:55,614", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'account_type'), 'msg': \"Input should be 'checking', 'savings', 'investment' or 'other'\", 'input': 'credit_card', 'ctx': {'expected': \"'checking', 'savings', 'investment' or 'other'\"}}] (request_id=c84d1c1b-5536-4c82-95d0-417440e9c940)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:55,614", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts 422 - request_id=unknown client=127.0.0.1 duration=0.027s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:55,614", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts "HTTP/1.1 422 Unprocessable Entity"
_______________ TestAccountRoutes.test_list_accounts_pagination ________________
tests/integration/test_account_routes.py:308: in test_list_accounts_pagination
    assert len(response.json()) == 2
E   assert 0 == 2
E    +  where 0 = len([])
E    +    where [] = json()
E    +      where json = <Response [200 OK]>.json
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:08:58,443", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,578", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: d3b8c8df-0ede-431a-9abe-4f78a5f31d1f (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,610", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=d3b8c8df-0ede-431a-9abe-4f78a5f31d1f, action=LOGIN, entity=user:d3b8c8df-0ede-431a-9abe-4f78a5f31d1f, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,613", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: d3b8c8df-0ede-431a-9abe-4f78a5f31d1f (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,613", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.083s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,614", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:08:58,654", "name": "src.services.account_service", "levelname": "INFO", "filename": "account_service.py", "lineno": 174, "funcName": "create_account", "message": "Created account 6b865d30-a648-415e-b560-a2042b6794bc (Account 0) for user d3b8c8df-0ede-431a-9abe-4f78a5f31d1f", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,661", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=d3b8c8df-0ede-431a-9abe-4f78a5f31d1f, action=CREATE, entity=account:6b865d30-a648-415e-b560-a2042b6794bc, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,661", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/v1/accounts 201 - request_id=unknown client=127.0.0.1 duration=0.047s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,665", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,706", "name": "src.services.account_service", "levelname": "INFO", "filename": "account_service.py", "lineno": 174, "funcName": "create_account", "message": "Created account 0f8d8f18-42f4-46d1-a7a8-220f84247216 (Account 1) for user d3b8c8df-0ede-431a-9abe-4f78a5f31d1f", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,712", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=d3b8c8df-0ede-431a-9abe-4f78a5f31d1f, action=CREATE, entity=account:0f8d8f18-42f4-46d1-a7a8-220f84247216, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,712", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/v1/accounts 201 - request_id=unknown client=127.0.0.1 duration=0.047s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,715", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,753", "name": "src.services.account_service", "levelname": "INFO", "filename": "account_service.py", "lineno": 174, "funcName": "create_account", "message": "Created account dc4d3f83-7945-425a-97a0-5daabfdfd0f8 (Account 2) for user d3b8c8df-0ede-431a-9abe-4f78a5f31d1f", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,759", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=d3b8c8df-0ede-431a-9abe-4f78a5f31d1f, action=CREATE, entity=account:dc4d3f83-7945-425a-97a0-5daabfdfd0f8, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,760", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/v1/accounts 201 - request_id=unknown client=127.0.0.1 duration=0.044s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,763", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,806", "name": "src.services.account_service", "levelname": "INFO", "filename": "account_service.py", "lineno": 174, "funcName": "create_account", "message": "Created account e1582f94-49ad-4d2b-a42c-2b6223d19b7d (Account 3) for user d3b8c8df-0ede-431a-9abe-4f78a5f31d1f", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,812", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=d3b8c8df-0ede-431a-9abe-4f78a5f31d1f, action=CREATE, entity=account:e1582f94-49ad-4d2b-a42c-2b6223d19b7d, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,812", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/v1/accounts 201 - request_id=unknown client=127.0.0.1 duration=0.049s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,815", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,854", "name": "src.services.account_service", "levelname": "INFO", "filename": "account_service.py", "lineno": 174, "funcName": "create_account", "message": "Created account 62719fe7-c2a4-47ac-85dd-76358997c090 (Account 4) for user d3b8c8df-0ede-431a-9abe-4f78a5f31d1f", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,860", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=d3b8c8df-0ede-431a-9abe-4f78a5f31d1f, action=CREATE, entity=account:62719fe7-c2a4-47ac-85dd-76358997c090, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,861", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/v1/accounts 201 - request_id=unknown client=127.0.0.1 duration=0.046s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,864", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts \"HTTP/1.1 201 Created\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,903", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "GET /api/v1/accounts 200 - request_id=unknown client=127.0.0.1 duration=0.039s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,906", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: GET http://test/api/v1/accounts?skip=0&limit=2 \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,945", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "GET /api/v1/accounts 200 - request_id=unknown client=127.0.0.1 duration=0.039s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:08:58,948", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: GET http://test/api/v1/accounts?skip=2&limit=2 \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts "HTTP/1.1 201 Created"
INFO     httpx:_client.py:1740 HTTP Request: GET http://test/api/v1/accounts?skip=0&limit=2 "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: GET http://test/api/v1/accounts?skip=2&limit=2 "HTTP/1.1 200 OK"
_______________________ test_create_share_viewer_success _______________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 194, in test_create_share_viewer_success
    |     response = await async_client.post(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<13 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 194, in test_create_share_viewer_success
    response = await async_client.post(
               ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/integration/test_account_sharing_routes.py:194: in test_create_share_viewer_success
    response = await async_client.post(
.venv/lib/python3.13/site-packages/httpx/_client.py:1859: in post
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:02,655", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:02,940", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: cfa50ec8-b6cc-4682-9f0a-44e29f8fd3e2 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:02,973", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=cfa50ec8-b6cc-4682-9f0a-44e29f8fd3e2, action=LOGIN, entity=user:cfa50ec8-b6cc-4682-9f0a-44e29f8fd3e2, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:02,976", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: cfa50ec8-b6cc-4682-9f0a-44e29f8fd3e2 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:02,976", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.086s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:02,977", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:03,002", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: POST /api/v1/accounts/a33636f1-c88b-46d7-95b7-8829ba37fb84/shares - request_id=unknown client=127.0.0.1 duration=0.025s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:03,015", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=dca091e3-702e-4185-a150-2baeb0316f2d)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
_______________________ test_create_share_editor_success _______________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 225, in test_create_share_editor_success
    |     response = await async_client.post(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<13 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 225, in test_create_share_editor_success
    response = await async_client.post(
               ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/integration/test_account_sharing_routes.py:225: in test_create_share_editor_success
    response = await async_client.post(
.venv/lib/python3.13/site-packages/httpx/_client.py:1859: in post
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:03,291", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:03,565", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 628aa8ff-e7f4-4ba0-8bfd-e02c21c00875 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:03,600", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=628aa8ff-e7f4-4ba0-8bfd-e02c21c00875, action=LOGIN, entity=user:628aa8ff-e7f4-4ba0-8bfd-e02c21c00875, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:03,603", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 628aa8ff-e7f4-4ba0-8bfd-e02c21c00875 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:03,603", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.088s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:03,604", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:03,628", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: POST /api/v1/accounts/d9bc4c94-9b3d-4e6f-8cd8-bc69e81aa8e3/shares - request_id=unknown client=127.0.0.1 duration=0.024s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:03,641", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=5778b039-5e6a-48c6-8a35-39c9f920a6b5)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
_______________ test_create_share_cannot_grant_owner_permission ________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 252, in test_create_share_cannot_grant_owner_permission
    |     response = await async_client.post(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<13 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 252, in test_create_share_cannot_grant_owner_permission
    response = await async_client.post(
               ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/integration/test_account_sharing_routes.py:252: in test_create_share_cannot_grant_owner_permission
    response = await async_client.post(
.venv/lib/python3.13/site-packages/httpx/_client.py:1859: in post
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:03,921", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:04,196", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 42c45e5b-5413-44fa-ad4b-7f8556dedd9d (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:04,233", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=42c45e5b-5413-44fa-ad4b-7f8556dedd9d, action=LOGIN, entity=user:42c45e5b-5413-44fa-ad4b-7f8556dedd9d, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:04,236", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 42c45e5b-5413-44fa-ad4b-7f8556dedd9d (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:04,236", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.091s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:04,236", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:04,261", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: POST /api/v1/accounts/19d8c1d1-064c-4eaa-8425-32664a3272d0/shares - request_id=unknown client=127.0.0.1 duration=0.024s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:04,274", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=41652e4a-c3a1-4da1-84f6-4f6c0d8b089a)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
___________________ test_create_share_non_owner_cannot_share ___________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 276, in test_create_share_non_owner_cannot_share
    |     response = await async_client.post(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<13 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 276, in test_create_share_non_owner_cannot_share
    response = await async_client.post(
               ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/integration/test_account_sharing_routes.py:276: in test_create_share_non_owner_cannot_share
    response = await async_client.post(
.venv/lib/python3.13/site-packages/httpx/_client.py:1859: in post
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:04,573", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:05,023", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: cca97b37-884f-4a8a-8232-68330a772902 (user2@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:05,057", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=cca97b37-884f-4a8a-8232-68330a772902, action=LOGIN, entity=user:cca97b37-884f-4a8a-8232-68330a772902, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:05,059", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: cca97b37-884f-4a8a-8232-68330a772902 (user2@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:05,060", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.104s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:05,060", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:05,088", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: POST /api/v1/accounts/e181d741-e330-4f67-adb9-959de2d9c386/shares - request_id=unknown client=127.0.0.1 duration=0.027s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:05,101", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=3ba2dd71-67eb-4bb8-add5-1664f85bfb34)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
___________________ test_create_share_cannot_share_with_self ___________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 296, in test_create_share_cannot_share_with_self
    |     response = await async_client.post(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<13 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 296, in test_create_share_cannot_share_with_self
    response = await async_client.post(
               ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/integration/test_account_sharing_routes.py:296: in test_create_share_cannot_share_with_self
    response = await async_client.post(
.venv/lib/python3.13/site-packages/httpx/_client.py:1859: in post
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:05,379", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:05,586", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: c059cba2-2625-4a27-8527-921fb857bb34 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:05,618", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=c059cba2-2625-4a27-8527-921fb857bb34, action=LOGIN, entity=user:c059cba2-2625-4a27-8527-921fb857bb34, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:05,620", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: c059cba2-2625-4a27-8527-921fb857bb34 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:05,621", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.085s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:05,621", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:05,646", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: POST /api/v1/accounts/6f27cd88-208e-4535-a081-5353b5314a22/shares - request_id=unknown client=127.0.0.1 duration=0.024s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:05,659", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=c9cd8d68-4cf0-4508-a121-22152d5a1ea5)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
____________________ test_create_share_nonexistent_account _____________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 317, in test_create_share_nonexistent_account
    |     response = await async_client.post(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<13 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 317, in test_create_share_nonexistent_account
    response = await async_client.post(
               ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/integration/test_account_sharing_routes.py:317: in test_create_share_nonexistent_account
    response = await async_client.post(
.venv/lib/python3.13/site-packages/httpx/_client.py:1859: in post
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:05,927", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:06,134", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: f13331ee-8207-49b5-a248-5030cc092188 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:06,168", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=f13331ee-8207-49b5-a248-5030cc092188, action=LOGIN, entity=user:f13331ee-8207-49b5-a248-5030cc092188, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:06,171", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: f13331ee-8207-49b5-a248-5030cc092188 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:06,171", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.089s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:06,172", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:06,196", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: POST /api/v1/accounts/058827c8-b8d7-43e7-9cbb-e4f425f78e61/shares - request_id=unknown client=127.0.0.1 duration=0.024s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:06,209", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=fcd82688-370f-49f2-b463-70b72e372517)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
______________________ test_create_share_nonexistent_user ______________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 338, in test_create_share_nonexistent_user
    |     response = await async_client.post(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<13 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 338, in test_create_share_nonexistent_user
    response = await async_client.post(
               ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/integration/test_account_sharing_routes.py:338: in test_create_share_nonexistent_user
    response = await async_client.post(
.venv/lib/python3.13/site-packages/httpx/_client.py:1859: in post
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:06,484", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:06,695", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: ee938809-a2b5-4701-b58c-bcb9b9dedf5a (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:06,729", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=ee938809-a2b5-4701-b58c-bcb9b9dedf5a, action=LOGIN, entity=user:ee938809-a2b5-4701-b58c-bcb9b9dedf5a, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:06,732", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: ee938809-a2b5-4701-b58c-bcb9b9dedf5a (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:06,732", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.086s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:06,733", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:06,756", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: POST /api/v1/accounts/b0ad3238-7730-4154-a22f-191343890040/shares - request_id=unknown client=127.0.0.1 duration=0.023s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:06,769", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=ba10c3b4-5ca5-4284-b9ce-736f5e70fd25)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
______________________ test_create_share_duplicate_share _______________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 360, in test_create_share_duplicate_share
    |     response = await async_client.post(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<13 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 360, in test_create_share_duplicate_share
    response = await async_client.post(
               ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/integration/test_account_sharing_routes.py:360: in test_create_share_duplicate_share
    response = await async_client.post(
.venv/lib/python3.13/site-packages/httpx/_client.py:1859: in post
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:07,041", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:07,383", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 2d3dc44d-77dd-44f6-9872-4a4ecbd4307d (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:07,417", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=2d3dc44d-77dd-44f6-9872-4a4ecbd4307d, action=LOGIN, entity=user:2d3dc44d-77dd-44f6-9872-4a4ecbd4307d, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:07,420", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 2d3dc44d-77dd-44f6-9872-4a4ecbd4307d (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:07,420", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.087s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:07,421", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:07,446", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: POST /api/v1/accounts/ba2f3e13-0d5f-4963-904c-d1849579294d/shares - request_id=unknown client=127.0.0.1 duration=0.024s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:07,458", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=dfbcb6d8-47f3-440d-8404-b3f0a4790723)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
_______________________ test_list_shares_owner_sees_all ________________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 386, in test_list_shares_owner_sees_all
    |     await async_client.post(
    |     ...<3 lines>...
    |     )
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<13 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 386, in test_list_shares_owner_sees_all
    await async_client.post(
    ...<3 lines>...
    )
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/integration/test_account_sharing_routes.py:386: in test_list_shares_owner_sees_all
    await async_client.post(
.venv/lib/python3.13/site-packages/httpx/_client.py:1859: in post
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:07,734", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:08,085", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 8e50af60-df44-4720-940d-96304e66acba (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:08,117", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=8e50af60-df44-4720-940d-96304e66acba, action=LOGIN, entity=user:8e50af60-df44-4720-940d-96304e66acba, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:08,119", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 8e50af60-df44-4720-940d-96304e66acba (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:08,120", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.088s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:08,120", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:08,144", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: POST /api/v1/accounts/513b42b6-e885-4d29-95d9-b2e69302e0af/shares - request_id=unknown client=127.0.0.1 duration=0.023s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:08,156", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=cfa74f76-925e-4296-bb17-178bf750686a)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
_______________________ test_list_shares_editor_can_view _______________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 424, in test_list_shares_editor_can_view
    |     response = await async_client.get(
    |                ^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<2 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1768, in get
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<9 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 424, in test_list_shares_editor_can_view
    response = await async_client.get(
               ^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1768, in get
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/integration/test_account_sharing_routes.py:424: in test_list_shares_editor_can_view
    response = await async_client.get(
.venv/lib/python3.13/site-packages/httpx/_client.py:1768: in get
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:08,424", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:08,766", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 07ec2ec7-b9ac-48f7-a5f3-aeb81514c063 (user2@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:08,800", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=07ec2ec7-b9ac-48f7-a5f3-aeb81514c063, action=LOGIN, entity=user:07ec2ec7-b9ac-48f7-a5f3-aeb81514c063, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:08,803", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 07ec2ec7-b9ac-48f7-a5f3-aeb81514c063 (user2@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:08,803", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.086s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:08,803", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:08,828", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: GET /api/v1/accounts/2bb7ffe4-5f26-4278-8704-8a8764d61c40/shares - request_id=unknown client=127.0.0.1 duration=0.023s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:08,840", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=66806217-762e-4339-bed8-6867da3e9a6d)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
_______________________ test_list_shares_viewer_can_view _______________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 446, in test_list_shares_viewer_can_view
    |     response = await async_client.get(
    |                ^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<2 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1768, in get
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<9 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 446, in test_list_shares_viewer_can_view
    response = await async_client.get(
               ^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1768, in get
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/integration/test_account_sharing_routes.py:446: in test_list_shares_viewer_can_view
    response = await async_client.get(
.venv/lib/python3.13/site-packages/httpx/_client.py:1768: in get
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:09,118", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:09,458", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 3b83bf41-91ae-4e13-9a9c-8e7142fa4f7a (user2@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:09,493", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=3b83bf41-91ae-4e13-9a9c-8e7142fa4f7a, action=LOGIN, entity=user:3b83bf41-91ae-4e13-9a9c-8e7142fa4f7a, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:09,495", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 3b83bf41-91ae-4e13-9a9c-8e7142fa4f7a (user2@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:09,495", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.088s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:09,496", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:09,519", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: GET /api/v1/accounts/a9379b72-0a84-4bbb-a493-fa596b7d739e/shares - request_id=unknown client=127.0.0.1 duration=0.023s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:09,532", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=cf069123-f6f5-48e5-a69b-f75ba5dc9433)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
___________________ test_list_shares_non_member_cannot_view ____________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 465, in test_list_shares_non_member_cannot_view
    |     response = await async_client.get(
    |                ^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<2 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1768, in get
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<9 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 465, in test_list_shares_non_member_cannot_view
    response = await async_client.get(
               ^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1768, in get
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/integration/test_account_sharing_routes.py:465: in test_list_shares_non_member_cannot_view
    response = await async_client.get(
.venv/lib/python3.13/site-packages/httpx/_client.py:1768: in get
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:09,865", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:10,142", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: cdf1ae72-755f-47a6-9d46-ed2bd0e39b9d (user2@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:10,175", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=cdf1ae72-755f-47a6-9d46-ed2bd0e39b9d, action=LOGIN, entity=user:cdf1ae72-755f-47a6-9d46-ed2bd0e39b9d, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:10,177", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: cdf1ae72-755f-47a6-9d46-ed2bd0e39b9d (user2@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:10,177", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.085s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:10,178", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:10,202", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: GET /api/v1/accounts/5a7a94ec-bf34-4d4c-8575-c8ef7b3661bb/shares - request_id=unknown client=127.0.0.1 duration=0.024s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:10,215", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=69d7de58-6ff8-44b4-9d05-a7c580dfccca)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
_________________ test_list_shares_empty_for_unshared_account __________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 480, in test_list_shares_empty_for_unshared_account
    |     response = await async_client.get(
    |                ^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<2 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1768, in get
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<9 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 480, in test_list_shares_empty_for_unshared_account
    response = await async_client.get(
               ^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1768, in get
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/integration/test_account_sharing_routes.py:480: in test_list_shares_empty_for_unshared_account
    response = await async_client.get(
.venv/lib/python3.13/site-packages/httpx/_client.py:1768: in get
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:10,493", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:10,701", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 94d00003-34ba-4965-9f9e-cb7069395f15 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:10,734", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=94d00003-34ba-4965-9f9e-cb7069395f15, action=LOGIN, entity=user:94d00003-34ba-4965-9f9e-cb7069395f15, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:10,737", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 94d00003-34ba-4965-9f9e-cb7069395f15 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:10,737", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.092s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:10,738", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:10,762", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: GET /api/v1/accounts/206bd089-e693-434e-bc50-300e293e9b52/shares - request_id=unknown client=127.0.0.1 duration=0.024s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:10,775", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=08163256-fafa-49f5-91aa-dcd90b8c3264)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
__________________ test_update_share_upgrade_viewer_to_editor __________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 505, in test_update_share_upgrade_viewer_to_editor
    |     response = await async_client.put(
    |                ^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1896, in put
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<13 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 505, in test_update_share_upgrade_viewer_to_editor
    response = await async_client.put(
               ^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1896, in put
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/integration/test_account_sharing_routes.py:505: in test_update_share_upgrade_viewer_to_editor
    response = await async_client.put(
.venv/lib/python3.13/site-packages/httpx/_client.py:1896: in put
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:11,079", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:11,424", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 57d6af90-733c-45ee-bf6e-5a6cb777dedd (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:11,458", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=57d6af90-733c-45ee-bf6e-5a6cb777dedd, action=LOGIN, entity=user:57d6af90-733c-45ee-bf6e-5a6cb777dedd, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:11,461", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 57d6af90-733c-45ee-bf6e-5a6cb777dedd (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:11,461", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.086s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:11,462", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:11,487", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: PUT /api/v1/accounts/01078c58-8d01-4e21-b2b8-d97c17cc61e7/shares/f5c90470-3263-4742-97d8-eb73b74c0b0d - request_id=unknown client=127.0.0.1 duration=0.025s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:11,500", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=80ca596d-6a60-420e-a678-6699723f99d7)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
_________________ test_update_share_downgrade_editor_to_viewer _________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 528, in test_update_share_downgrade_editor_to_viewer
    |     response = await async_client.put(
    |                ^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1896, in put
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<13 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 528, in test_update_share_downgrade_editor_to_viewer
    response = await async_client.put(
               ^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1896, in put
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/integration/test_account_sharing_routes.py:528: in test_update_share_downgrade_editor_to_viewer
    response = await async_client.put(
.venv/lib/python3.13/site-packages/httpx/_client.py:1896: in put
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:11,783", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:12,234", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 58275fa6-5d32-423e-bcc5-52bbea1f19d9 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:12,277", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=58275fa6-5d32-423e-bcc5-52bbea1f19d9, action=LOGIN, entity=user:58275fa6-5d32-423e-bcc5-52bbea1f19d9, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:12,280", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 58275fa6-5d32-423e-bcc5-52bbea1f19d9 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:12,281", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.109s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:12,281", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:12,313", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: PUT /api/v1/accounts/779994d9-8e64-4744-aaf0-0f19fab4ac11/shares/47d2eb5e-348f-46fb-b186-a163a6a05921 - request_id=unknown client=127.0.0.1 duration=0.030s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:12,327", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=a39832d1-66a1-4185-986b-96a5133222e9)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
_______________ test_update_share_cannot_grant_owner_permission ________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 551, in test_update_share_cannot_grant_owner_permission
    |     response = await async_client.put(
    |                ^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1896, in put
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<13 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 551, in test_update_share_cannot_grant_owner_permission
    response = await async_client.put(
               ^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1896, in put
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/integration/test_account_sharing_routes.py:551: in test_update_share_cannot_grant_owner_permission
    response = await async_client.put(
.venv/lib/python3.13/site-packages/httpx/_client.py:1896: in put
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:12,624", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:13,037", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 9700e760-63e2-459d-94e0-8290f4638791 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:13,075", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=9700e760-63e2-459d-94e0-8290f4638791, action=LOGIN, entity=user:9700e760-63e2-459d-94e0-8290f4638791, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:13,077", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 9700e760-63e2-459d-94e0-8290f4638791 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:13,078", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.100s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:13,078", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:13,104", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: PUT /api/v1/accounts/5a8e8680-04bd-41de-87d1-489d490a0625/shares/1a7d2a76-4c1d-47d7-bc9d-b19932930da6 - request_id=unknown client=127.0.0.1 duration=0.025s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:13,116", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=3b5ffbc2-463c-4753-90d6-9894acc7deaf)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
__________________ test_update_share_non_owner_cannot_update ___________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 594, in test_update_share_non_owner_cannot_update
    |     response = await async_client.put(
    |                ^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1896, in put
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<13 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 594, in test_update_share_non_owner_cannot_update
    response = await async_client.put(
               ^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1896, in put
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/integration/test_account_sharing_routes.py:594: in test_update_share_non_owner_cannot_update
    response = await async_client.put(
.venv/lib/python3.13/site-packages/httpx/_client.py:1896: in put
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:13,391", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:13,799", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 531625d6-4ce9-4d54-b477-05abf656d412 (user2@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:13,831", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=531625d6-4ce9-4d54-b477-05abf656d412, action=LOGIN, entity=user:531625d6-4ce9-4d54-b477-05abf656d412, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:13,833", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 531625d6-4ce9-4d54-b477-05abf656d412 (user2@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:13,834", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.085s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:13,834", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:13,928", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: PUT /api/v1/accounts/0f7e0197-3cc7-4801-ade6-d4a11d3a2824/shares/2e92ae4e-1c6b-4997-8f37-fc5fd3c45c02 - request_id=unknown client=127.0.0.1 duration=0.024s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:13,940", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=6768c0c5-e1d2-4981-8647-e7378e078909)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
_____________________ test_update_share_nonexistent_share ______________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 612, in test_update_share_nonexistent_share
    |     response = await async_client.put(
    |                ^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1896, in put
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<13 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 612, in test_update_share_nonexistent_share
    response = await async_client.put(
               ^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1896, in put
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/integration/test_account_sharing_routes.py:612: in test_update_share_nonexistent_share
    response = await async_client.put(
.venv/lib/python3.13/site-packages/httpx/_client.py:1896: in put
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:14,205", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:14,409", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 80ef5ae4-d860-4895-9a5a-044dac3bf4f5 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:14,442", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=80ef5ae4-d860-4895-9a5a-044dac3bf4f5, action=LOGIN, entity=user:80ef5ae4-d860-4895-9a5a-044dac3bf4f5, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:14,445", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 80ef5ae4-d860-4895-9a5a-044dac3bf4f5 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:14,446", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.086s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:14,446", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:14,471", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: PUT /api/v1/accounts/3f355f03-9d0a-4ee8-8610-4722dc675021/shares/3adc4cbe-d7cb-4076-af8b-c4212da73e98 - request_id=unknown client=127.0.0.1 duration=0.024s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:14,483", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=8b0258d1-f090-40e8-a4e4-74aff55fb1f8)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
_________________ test_update_share_cannot_modify_owner_share __________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 634, in test_update_share_cannot_modify_owner_share
    |     response = await async_client.put(
    |                ^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1896, in put
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<13 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 634, in test_update_share_cannot_modify_owner_share
    response = await async_client.put(
               ^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1896, in put
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<13 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/integration/test_account_sharing_routes.py:634: in test_update_share_cannot_modify_owner_share
    response = await async_client.put(
.venv/lib/python3.13/site-packages/httpx/_client.py:1896: in put
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:14,755", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:14,971", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 157d4438-05bf-4970-80e4-fa217ecc4b48 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:15,004", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=157d4438-05bf-4970-80e4-fa217ecc4b48, action=LOGIN, entity=user:157d4438-05bf-4970-80e4-fa217ecc4b48, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:15,007", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 157d4438-05bf-4970-80e4-fa217ecc4b48 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:15,007", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.086s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:15,008", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:15,032", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: PUT /api/v1/accounts/b24ac8cc-c44b-48dd-af75-373c0b71376b/shares/bb0b99dd-1953-40b8-a9be-0b41865b430e - request_id=unknown client=127.0.0.1 duration=0.024s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:15,044", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=afa27882-81ca-478a-a501-131a4f9afbcb)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
_______________________ test_revoke_share_viewer_success _______________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 656, in test_revoke_share_viewer_success
    |     response = await async_client.delete(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<2 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1966, in delete
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<9 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 656, in test_revoke_share_viewer_success
    response = await async_client.delete(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1966, in delete
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/integration/test_account_sharing_routes.py:656: in test_revoke_share_viewer_success
    response = await async_client.delete(
.venv/lib/python3.13/site-packages/httpx/_client.py:1966: in delete
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:15,316", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:15,662", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 42e55adb-f3c7-4b37-b3da-81033be394d0 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:15,695", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=42e55adb-f3c7-4b37-b3da-81033be394d0, action=LOGIN, entity=user:42e55adb-f3c7-4b37-b3da-81033be394d0, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:15,698", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 42e55adb-f3c7-4b37-b3da-81033be394d0 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:15,699", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.086s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:15,699", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:15,723", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: DELETE /api/v1/accounts/83bc944f-ac5a-4136-a91c-4c0c7a7a1371/shares/243f1356-fb37-4742-9836-e20d27dd0ed9 - request_id=unknown client=127.0.0.1 duration=0.023s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:15,735", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=2b08d27b-c323-411d-b284-07e6566749bd)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
_______________________ test_revoke_share_editor_success _______________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 674, in test_revoke_share_editor_success
    |     response = await async_client.delete(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<2 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1966, in delete
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<9 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 674, in test_revoke_share_editor_success
    response = await async_client.delete(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1966, in delete
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/integration/test_account_sharing_routes.py:674: in test_revoke_share_editor_success
    response = await async_client.delete(
.venv/lib/python3.13/site-packages/httpx/_client.py:1966: in delete
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:16,005", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:16,343", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 4abf490c-55a9-4d85-b434-ca351e608166 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:16,376", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=4abf490c-55a9-4d85-b434-ca351e608166, action=LOGIN, entity=user:4abf490c-55a9-4d85-b434-ca351e608166, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:16,379", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 4abf490c-55a9-4d85-b434-ca351e608166 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:16,379", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.085s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:16,380", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:16,403", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: DELETE /api/v1/accounts/24d30802-df98-489f-93fb-899f0ba155eb/shares/c83d5135-16d6-41c2-9918-ae02711a7cd5 - request_id=unknown client=127.0.0.1 duration=0.023s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:16,416", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=134269f2-a0d9-48ad-ba58-0da962f403b7)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
__________________ test_revoke_share_non_owner_cannot_revoke ___________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 716, in test_revoke_share_non_owner_cannot_revoke
    |     response = await async_client.delete(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<2 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1966, in delete
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<9 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 716, in test_revoke_share_non_owner_cannot_revoke
    response = await async_client.delete(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1966, in delete
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/integration/test_account_sharing_routes.py:716: in test_revoke_share_non_owner_cannot_revoke
    response = await async_client.delete(
.venv/lib/python3.13/site-packages/httpx/_client.py:1966: in delete
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:16,694", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:17,134", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 3e222f03-c451-47c3-bffd-0c0daff21f7e (user2@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:17,167", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=3e222f03-c451-47c3-bffd-0c0daff21f7e, action=LOGIN, entity=user:3e222f03-c451-47c3-bffd-0c0daff21f7e, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:17,170", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 3e222f03-c451-47c3-bffd-0c0daff21f7e (user2@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:17,170", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.087s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:17,170", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:17,265", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: DELETE /api/v1/accounts/fc7c8e28-90b7-4528-8c26-1d91f0219391/shares/bae7129f-081f-4b97-a69b-3c74bab78b3c - request_id=unknown client=127.0.0.1 duration=0.025s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:17,278", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=c49adcb6-7a22-4a0e-9195-9272665b6755)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
_________________ test_revoke_share_cannot_revoke_owner_share __________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 737, in test_revoke_share_cannot_revoke_owner_share
    |     response = await async_client.delete(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<2 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1966, in delete
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<9 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 737, in test_revoke_share_cannot_revoke_owner_share
    response = await async_client.delete(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1966, in delete
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/integration/test_account_sharing_routes.py:737: in test_revoke_share_cannot_revoke_owner_share
    response = await async_client.delete(
.venv/lib/python3.13/site-packages/httpx/_client.py:1966: in delete
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:17,563", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:17,767", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 6309cf1c-7b59-4c7c-b12e-b8053f877ca0 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:17,801", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=6309cf1c-7b59-4c7c-b12e-b8053f877ca0, action=LOGIN, entity=user:6309cf1c-7b59-4c7c-b12e-b8053f877ca0, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:17,804", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 6309cf1c-7b59-4c7c-b12e-b8053f877ca0 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:17,804", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.087s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:17,804", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:17,829", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: DELETE /api/v1/accounts/088ecd1a-83e9-489f-bb76-8d5c810b022f/shares/b81178be-7b42-4fd3-bb1c-ec454d577a92 - request_id=unknown client=127.0.0.1 duration=0.023s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:17,841", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=45e77e25-ac6a-4161-b4aa-2754e704764a)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
_______________ test_revoke_share_user_loses_access_immediately ________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 474, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 721, in inner
    |     runner.run(coro, context=context)
    |     ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 720, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 757, in test_revoke_share_user_loses_access_immediately
    |     response = await async_client.delete(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<2 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1966, in delete
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |     ...<9 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    |     solved = await run_in_threadpool(call, **solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    |     result = context.run(func, *args)
    |   File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    |     return AccountService(db)
    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/danieltorres/Documents/emerald/emerald-backend/tests/integration/test_account_sharing_routes.py", line 757, in test_revoke_share_user_loses_access_immediately
    response = await async_client.delete(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1966, in delete
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 102, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 182, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py", line 56, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py", line 380, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
  File "/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py", line 32, in get_account_service
    return AccountService(db)
TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'

The above exception was the direct cause of the following exception:
tests/integration/test_account_sharing_routes.py:757: in test_revoke_share_user_loses_access_immediately
    response = await async_client.delete(
.venv/lib/python3.13/site-packages/httpx/_client.py:1966: in delete
    return await self.request(
.venv/lib/python3.13/site-packages/httpx/_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1629: in send
    response = await self._send_handling_auth(
.venv/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
.venv/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
.venv/lib/python3.13/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:102: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:182: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
.venv/lib/python3.13/site-packages/starlette/_utils.py:85: in collapse_excgroups
    raise exc
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/middleware.py:56: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
.venv/lib/python3.13/site-packages/starlette/middleware/base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
.venv/lib/python3.13/site-packages/fastapi/routing.py:124: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
.venv/lib/python3.13/site-packages/fastapi/routing.py:110: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/fastapi/routing.py:380: in app
    solved_result = await solve_dependencies(
.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py:675: in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/api/routes/account_shares.py:32: in get_account_service
    return AccountService(db)
           ^^^^^^^^^^^^^^^^^^
E   TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:18,188", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:18,540", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: f8abebd3-bc09-4e98-a909-c12958699b1e (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:18,573", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=f8abebd3-bc09-4e98-a909-c12958699b1e, action=LOGIN, entity=user:f8abebd3-bc09-4e98-a909-c12958699b1e, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:18,576", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: f8abebd3-bc09-4e98-a909-c12958699b1e (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:18,577", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.088s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:18,577", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:18,630", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 4d4c3e6f-4ce9-42c5-b9ed-6cecc4d2621b (user2@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:18,663", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=4d4c3e6f-4ce9-42c5-b9ed-6cecc4d2621b, action=LOGIN, entity=user:4d4c3e6f-4ce9-42c5-b9ed-6cecc4d2621b, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:18,665", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 4d4c3e6f-4ce9-42c5-b9ed-6cecc4d2621b (user2@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:18,666", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.088s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:18,666", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:18,690", "name": "src.middleware", "levelname": "ERROR", "filename": "middleware.py", "lineno": 186, "funcName": "dispatch", "message": "Request failed: DELETE /api/v1/accounts/ea0e22d1-db62-4334-aedd-c0b711aae6c6/shares/61b26f02-3c5b-4b01-bf19-32e99b83eb59 - request_id=unknown client=127.0.0.1 duration=0.023s error=AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:18,702", "name": "src.main", "levelname": "ERROR", "filename": "main.py", "lineno": 199, "funcName": "general_exception_handler", "message": "Unexpected error: AccountService.__init__() missing 1 required positional argument: 'encryption_service' (request_id=f9a68e8a-7935-4b8f-abba-5c7b2dfc09c8)", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    |     solved_result = await solve_dependencies(\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<6 lines>...\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    |     solved = await run_in_threadpool(call, **solved_result.values)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |         func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     )\n    |     ^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    |     result = context.run(func, *args)\n    |   File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    |     return AccountService(db)\n    | TypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 102, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 182, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/middleware.py\", line 56, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 124, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 110, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 380, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 675, in solve_dependencies\n    solved = await run_in_threadpool(call, **solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        func, args, abandon_on_cancel=abandon_on_cancel, limiter=limiter\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 2485, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\", line 976, in run\n    result = context.run(func, *args)\n  File \"/Users/danieltorres/Documents/emerald/emerald-backend/src/api/routes/account_shares.py\", line 32, in get_account_service\n    return AccountService(db)\nTypeError: AccountService.__init__() missing 1 required positional argument: 'encryption_service'", "correlation_id": "no-request-id"}
_______________ TestPasswordChange.test_change_password_success ________________
tests/integration/test_auth_routes.py:337: in test_change_password_success
    assert refresh_response.status_code == 401
E   assert 200 == 401
E    +  where 200 = <Response [200 OK]>.status_code
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:23,482", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:23,619", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 5c482afa-24d2-4fea-b658-4aac59414691 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:23,652", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=5c482afa-24d2-4fea-b658-4aac59414691, action=LOGIN, entity=user:5c482afa-24d2-4fea-b658-4aac59414691, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:23,655", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 5c482afa-24d2-4fea-b658-4aac59414691 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:23,655", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.086s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:23,656", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:23,728", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 428, "funcName": "change_password", "message": "Password changed for user 5c482afa-24d2-4fea-b658-4aac59414691. Revoked 0 refresh tokens.", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:23,760", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=5c482afa-24d2-4fea-b658-4aac59414691, action=PASSWORD_CHANGE, entity=user:5c482afa-24d2-4fea-b658-4aac59414691, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:23,762", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 444, "funcName": "change_password", "message": "Password changed for user 5c482afa-24d2-4fea-b658-4aac59414691", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:23,762", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/change-password 204 - request_id=unknown client=127.0.0.1 duration=0.106s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:23,763", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/change-password \"HTTP/1.1 204 No Content\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:23,813", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 5c482afa-24d2-4fea-b658-4aac59414691 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:23,847", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=5c482afa-24d2-4fea-b658-4aac59414691, action=LOGIN, entity=user:5c482afa-24d2-4fea-b658-4aac59414691, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:23,850", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 5c482afa-24d2-4fea-b658-4aac59414691 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:23,850", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.087s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:23,850", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:23,881", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 315, "funcName": "refresh_access_token", "message": "Access token refreshed for user 5c482afa-24d2-4fea-b658-4aac59414691", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:23,912", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=5c482afa-24d2-4fea-b658-4aac59414691, action=TOKEN_REFRESH, entity=user:5c482afa-24d2-4fea-b658-4aac59414691, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:23,914", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 292, "funcName": "refresh", "message": "Token refreshed successfully", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:23,914", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/refresh 200 - request_id=unknown client=127.0.0.1 duration=0.063s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:23,915", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/refresh \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/change-password "HTTP/1.1 204 No Content"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/refresh "HTTP/1.1 200 OK"
__________________ TestTransactionAPI.test_create_transaction __________________
tests/integration/test_transaction_api.py:43: in test_create_transaction
    assert response.status_code == 201
E   assert 422 == 201
E    +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:28,642", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:28,791", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 8c4f85fb-4927-4d00-a5db-44aad9f30d31 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:28,824", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=8c4f85fb-4927-4d00-a5db-44aad9f30d31, action=LOGIN, entity=user:8c4f85fb-4927-4d00-a5db-44aad9f30d31, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:28,827", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 8c4f85fb-4927-4d00-a5db-44aad9f30d31 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:28,827", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.086s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:28,827", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:28,917", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=2db25c75-97ab-425e-9350-3b095c517355)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:28,917", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/caedc441-a8bb-4472-8d77-a2b35211ee77/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.024s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:28,917", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/caedc441-a8bb-4472-8d77-a2b35211ee77/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/caedc441-a8bb-4472-8d77-a2b35211ee77/transactions "HTTP/1.1 422 Unprocessable Entity"
__________________ TestTransactionAPI.test_list_transactions ___________________
tests/integration/test_transaction_api.py:76: in test_list_transactions
    assert data["total"] >= 3
E   assert 0 >= 3
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:29,020", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:29,152", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: d09954d2-7146-413d-809e-a765c37485af (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:29,186", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=d09954d2-7146-413d-809e-a765c37485af, action=LOGIN, entity=user:d09954d2-7146-413d-809e-a765c37485af, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:29,189", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: d09954d2-7146-413d-809e-a765c37485af (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:29,189", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.087s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:29,190", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:29,296", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=dd3474f3-57d3-43ad-9b18-56974eba44d4)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:29,297", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/7d672203-528f-4807-af6b-3c8765ab7f3c/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.024s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:29,297", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/7d672203-528f-4807-af6b-3c8765ab7f3c/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:29,321", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=442b404c-ece0-413d-8892-365d71445d42)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:29,322", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/7d672203-528f-4807-af6b-3c8765ab7f3c/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.024s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:29,322", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/7d672203-528f-4807-af6b-3c8765ab7f3c/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:29,346", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=f2aa669f-672a-406c-834f-e80afb0a694a)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:29,346", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/7d672203-528f-4807-af6b-3c8765ab7f3c/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.024s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:29,347", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/7d672203-528f-4807-af6b-3c8765ab7f3c/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:29,391", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "GET /api/v1/accounts/7d672203-528f-4807-af6b-3c8765ab7f3c/transactions 200 - request_id=unknown client=127.0.0.1 duration=0.044s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:29,393", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: GET http://test/api/v1/accounts/7d672203-528f-4807-af6b-3c8765ab7f3c/transactions \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/7d672203-528f-4807-af6b-3c8765ab7f3c/transactions "HTTP/1.1 422 Unprocessable Entity"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/7d672203-528f-4807-af6b-3c8765ab7f3c/transactions "HTTP/1.1 422 Unprocessable Entity"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/7d672203-528f-4807-af6b-3c8765ab7f3c/transactions "HTTP/1.1 422 Unprocessable Entity"
INFO     httpx:_client.py:1740 HTTP Request: GET http://test/api/v1/accounts/7d672203-528f-4807-af6b-3c8765ab7f3c/transactions "HTTP/1.1 200 OK"
___________________ TestTransactionAPI.test_get_transaction ____________________
tests/integration/test_transaction_api.py:96: in test_get_transaction
    transaction_id = create_response.json()["id"]
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'id'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:29,491", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:29,626", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 3c52b587-08a5-4013-800b-37532539dd0c (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:29,661", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=3c52b587-08a5-4013-800b-37532539dd0c, action=LOGIN, entity=user:3c52b587-08a5-4013-800b-37532539dd0c, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:29,663", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 3c52b587-08a5-4013-800b-37532539dd0c (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:29,664", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.086s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:29,664", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:29,758", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=98b24812-5867-420e-bee7-085fed77ad12)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:29,759", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/f25d46dd-e750-441c-bd43-9259c24a7dbb/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.025s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:29,759", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/f25d46dd-e750-441c-bd43-9259c24a7dbb/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/f25d46dd-e750-441c-bd43-9259c24a7dbb/transactions "HTTP/1.1 422 Unprocessable Entity"
__________________ TestTransactionAPI.test_update_transaction __________________
tests/integration/test_transaction_api.py:126: in test_update_transaction
    transaction_id = create_response.json()["id"]
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'id'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:29,861", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:29,995", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 57545240-21a3-4e64-a951-355c01aa50b6 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:30,031", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=57545240-21a3-4e64-a951-355c01aa50b6, action=LOGIN, entity=user:57545240-21a3-4e64-a951-355c01aa50b6, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:30,034", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 57545240-21a3-4e64-a951-355c01aa50b6 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:30,034", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.088s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:30,035", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:30,126", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=2b4e1295-fb57-42ed-82c7-681d80ac8234)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:30,127", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/7c66b9e9-1c06-478e-9117-b402d9251985/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.024s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:30,127", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/7c66b9e9-1c06-478e-9117-b402d9251985/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/7c66b9e9-1c06-478e-9117-b402d9251985/transactions "HTTP/1.1 422 Unprocessable Entity"
__________________ TestTransactionAPI.test_delete_transaction __________________
tests/integration/test_transaction_api.py:160: in test_delete_transaction
    transaction_id = create_response.json()["id"]
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'id'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:30,225", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:30,360", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: be68407c-cfb2-4684-afea-597d1042595b (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:30,395", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=be68407c-cfb2-4684-afea-597d1042595b, action=LOGIN, entity=user:be68407c-cfb2-4684-afea-597d1042595b, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:30,397", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: be68407c-cfb2-4684-afea-597d1042595b (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:30,397", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.087s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:30,398", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:30,495", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=c5de74f2-1d6b-4ca8-93ea-d43cba8f1fa0)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:30,495", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/479ad3cf-06cf-4b5a-989f-f60f97e46c00/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.026s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:30,496", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/479ad3cf-06cf-4b5a-989f-f60f97e46c00/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/479ad3cf-06cf-4b5a-989f-f60f97e46c00/transactions "HTTP/1.1 422 Unprocessable Entity"
__________________ TestTransactionAPI.test_split_transaction ___________________
tests/integration/test_transaction_api.py:195: in test_split_transaction
    transaction_id = create_response.json()["id"]
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'id'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:30,594", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:30,731", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: c93841e8-9986-49a2-a093-35d240ce10d1 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:30,767", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=c93841e8-9986-49a2-a093-35d240ce10d1, action=LOGIN, entity=user:c93841e8-9986-49a2-a093-35d240ce10d1, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:30,770", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: c93841e8-9986-49a2-a093-35d240ce10d1 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:30,770", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.090s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:30,771", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:30,865", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=3bebdb76-a090-4834-9fe1-7f26a903d0a9)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:30,865", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/74fa8796-8bc3-4078-a1ab-11fe83d9bdc8/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.025s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:30,865", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/74fa8796-8bc3-4078-a1ab-11fe83d9bdc8/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/74fa8796-8bc3-4078-a1ab-11fe83d9bdc8/transactions "HTTP/1.1 422 Unprocessable Entity"
________________ TestTransactionAPI.test_join_split_transaction ________________
tests/integration/test_transaction_api.py:231: in test_join_split_transaction
    transaction_id = create_response.json()["id"]
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'id'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:30,962", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:31,116", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 709eae55-3184-4f02-a593-1d21daf55351 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:31,165", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=709eae55-3184-4f02-a593-1d21daf55351, action=LOGIN, entity=user:709eae55-3184-4f02-a593-1d21daf55351, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:31,169", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 709eae55-3184-4f02-a593-1d21daf55351 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:31,170", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.108s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:31,170", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:31,269", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=779ef0b9-c78c-47de-9771-e939370cb215)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:31,269", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/54736746-93f5-4550-aaec-5084ef1a7588/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.024s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:31,270", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/54736746-93f5-4550-aaec-5084ef1a7588/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/54736746-93f5-4550-aaec-5084ef1a7588/transactions "HTTP/1.1 422 Unprocessable Entity"
_______________________ TestTransactionAPI.test_add_tag ________________________
tests/integration/test_transaction_api.py:271: in test_add_tag
    transaction_id = create_response.json()["id"]
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'id'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:31,365", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:31,500", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 3c93a82a-fd94-41c6-85cf-e97d54fc7dc4 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:31,535", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=3c93a82a-fd94-41c6-85cf-e97d54fc7dc4, action=LOGIN, entity=user:3c93a82a-fd94-41c6-85cf-e97d54fc7dc4, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:31,539", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 3c93a82a-fd94-41c6-85cf-e97d54fc7dc4 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:31,539", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.091s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:31,540", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:31,637", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=9606ae25-4e20-4cf3-b3ca-ce0e882be9de)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:31,637", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/049060a2-3f2d-407c-8154-dc2bdf01e9b3/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.024s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:31,637", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/049060a2-3f2d-407c-8154-dc2bdf01e9b3/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/049060a2-3f2d-407c-8154-dc2bdf01e9b3/transactions "HTTP/1.1 422 Unprocessable Entity"
______________________ TestTransactionAPI.test_remove_tag ______________________
tests/integration/test_transaction_api.py:302: in test_remove_tag
    transaction_id = create_response.json()["id"]
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'id'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:31,758", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:31,897", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 2fed86ee-928a-4efa-98ad-b8fe2d55cba5 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:31,930", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=2fed86ee-928a-4efa-98ad-b8fe2d55cba5, action=LOGIN, entity=user:2fed86ee-928a-4efa-98ad-b8fe2d55cba5, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:31,933", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 2fed86ee-928a-4efa-98ad-b8fe2d55cba5 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:31,933", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.089s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:31,934", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:32,026", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=8007508c-fe2b-4186-a7e9-560b565b1267)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:32,026", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/c7b4eb8a-8250-4fe0-b512-3559658c88bb/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.025s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:32,027", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/c7b4eb8a-8250-4fe0-b512-3559658c88bb/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/c7b4eb8a-8250-4fe0-b512-3559658c88bb/transactions "HTTP/1.1 422 Unprocessable Entity"
__________________ TestTransactionAPI.test_permission_denied ___________________
tests/integration/test_transaction_api.py:337: in test_permission_denied
    transaction_id = create_response.json()["id"]
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'id'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:32,121", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:32,326", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 241cb004-433c-4719-9934-b9bc5d39e6c7 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:32,360", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=241cb004-433c-4719-9934-b9bc5d39e6c7, action=LOGIN, entity=user:241cb004-433c-4719-9934-b9bc5d39e6c7, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:32,362", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 241cb004-433c-4719-9934-b9bc5d39e6c7 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:32,363", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.086s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:32,363", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:32,454", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=9b77164b-4ec4-45fe-8859-7ec8f5967b53)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:32,454", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/6cd62aae-c40b-4be2-8699-ac20a8103e66/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.024s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:32,455", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/6cd62aae-c40b-4be2-8699-ac20a8103e66/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/6cd62aae-c40b-4be2-8699-ac20a8103e66/transactions "HTTP/1.1 422 Unprocessable Entity"
____________________ test_viewer_cannot_create_transaction _____________________
tests/integration/test_transaction_api.py:415: in test_viewer_cannot_create_transaction
    assert response.status_code == 403
E   assert 422 == 403
E    +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:32,552", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:32,816", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 4fd034d4-798a-4ba0-8b3b-f4910ee4e6da (viewer@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:32,853", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=4fd034d4-798a-4ba0-8b3b-f4910ee4e6da, action=LOGIN, entity=user:4fd034d4-798a-4ba0-8b3b-f4910ee4e6da, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:32,855", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 4fd034d4-798a-4ba0-8b3b-f4910ee4e6da (viewer@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:32,855", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.092s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:32,856", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:32,881", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=343fb328-20dc-4513-8068-656381665277)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:32,882", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/2f774515-97a2-4c8c-bf31-276d230e095d/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.026s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:32,882", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/2f774515-97a2-4c8c-bf31-276d230e095d/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/2f774515-97a2-4c8c-bf31-276d230e095d/transactions "HTTP/1.1 422 Unprocessable Entity"
____________________ test_viewer_cannot_update_transaction _____________________
tests/integration/test_transaction_api.py:444: in test_viewer_cannot_update_transaction
    transaction_id = create_response.json()["id"]
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'id'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:32,983", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:33,123", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: de2d1118-a0b2-47d3-9451-91428fa414b3 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:33,158", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=de2d1118-a0b2-47d3-9451-91428fa414b3, action=LOGIN, entity=user:de2d1118-a0b2-47d3-9451-91428fa414b3, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:33,161", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: de2d1118-a0b2-47d3-9451-91428fa414b3 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:33,161", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.090s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:33,162", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:33,261", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=95d9c5cf-5619-4ddb-a6bd-ec52e1a091f5)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:33,261", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/0257d87a-1178-40f2-a34f-e27c10175d2a/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.025s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:33,261", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/0257d87a-1178-40f2-a34f-e27c10175d2a/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/0257d87a-1178-40f2-a34f-e27c10175d2a/transactions "HTTP/1.1 422 Unprocessable Entity"
____________________ test_viewer_cannot_delete_transaction _____________________
tests/integration/test_transaction_api.py:518: in test_viewer_cannot_delete_transaction
    transaction_id = create_response.json()["id"]
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'id'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:33,356", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:33,497", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 42474040-9974-4e44-ba1b-c01536e74742 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:33,539", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=42474040-9974-4e44-ba1b-c01536e74742, action=LOGIN, entity=user:42474040-9974-4e44-ba1b-c01536e74742, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:33,542", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 42474040-9974-4e44-ba1b-c01536e74742 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:33,542", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.100s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:33,542", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:33,642", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=b52212ab-4a6f-4f8e-8aac-4035b75c15dd)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:33,642", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/95ca62c1-ad20-4a32-aa44-58b60aa2c0c9/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.025s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:33,643", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/95ca62c1-ad20-4a32-aa44-58b60aa2c0c9/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/95ca62c1-ad20-4a32-aa44-58b60aa2c0c9/transactions "HTTP/1.1 422 Unprocessable Entity"
______________________ test_editor_can_create_transaction ______________________
tests/integration/test_transaction_api.py:627: in test_editor_can_create_transaction
    assert response.status_code == 201
E   assert 422 == 201
E    +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:33,739", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:33,999", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 30d5380b-8375-425c-840c-9f7b463d7404 (editor@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:34,033", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=30d5380b-8375-425c-840c-9f7b463d7404, action=LOGIN, entity=user:30d5380b-8375-425c-840c-9f7b463d7404, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:34,036", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 30d5380b-8375-425c-840c-9f7b463d7404 (editor@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:34,036", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.085s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:34,037", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:34,061", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=99c2f6e4-9651-4d8a-acb2-ecf5b75d5767)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:34,061", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/c7dc4663-4708-4cfe-9390-efeb7e7a9b5d/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.024s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:34,062", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/c7dc4663-4708-4cfe-9390-efeb7e7a9b5d/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/c7dc4663-4708-4cfe-9390-efeb7e7a9b5d/transactions "HTTP/1.1 422 Unprocessable Entity"
__________________________ test_owner_has_full_access __________________________
tests/integration/test_transaction_api.py:651: in test_owner_has_full_access
    assert create_response.status_code == 201
E   assert 422 == 201
E    +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:34,158", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:34,290", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: c2870aba-1dac-4e41-ae40-8c2a8a606bcd (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:34,323", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=c2870aba-1dac-4e41-ae40-8c2a8a606bcd, action=LOGIN, entity=user:c2870aba-1dac-4e41-ae40-8c2a8a606bcd, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:34,326", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: c2870aba-1dac-4e41-ae40-8c2a8a606bcd (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:34,326", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.085s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:34,327", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:34,417", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=feacd1cd-81f7-4b3b-aa9f-06e0ac7c83e7)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:34,417", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/86f77977-f04f-4b02-b518-d535f24d7772/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.024s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:34,418", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/86f77977-f04f-4b02-b518-d535f24d7772/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/86f77977-f04f-4b02-b518-d535f24d7772/transactions "HTTP/1.1 422 Unprocessable Entity"
______________ test_cannot_create_transaction_with_wrong_currency ______________
tests/integration/test_transaction_api.py:699: in test_cannot_create_transaction_with_wrong_currency
    assert response.status_code == 400
E   assert 422 == 400
E    +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:34,513", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:34,646", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 4448de16-8c5a-4f1f-bd39-713240539b55 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:34,680", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=4448de16-8c5a-4f1f-bd39-713240539b55, action=LOGIN, entity=user:4448de16-8c5a-4f1f-bd39-713240539b55, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:34,683", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 4448de16-8c5a-4f1f-bd39-713240539b55 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:34,683", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.086s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:34,684", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:34,775", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=e07e2f10-d3c6-4636-a462-ccd01d9646af)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:34,776", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/3297d0d1-7cc7-4258-b45c-f84c23b5c73d/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.026s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:34,776", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/3297d0d1-7cc7-4258-b45c-f84c23b5c73d/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/3297d0d1-7cc7-4258-b45c-f84c23b5c73d/transactions "HTTP/1.1 422 Unprocessable Entity"
___________________ test_split_transaction_maintains_balance ___________________
tests/integration/test_transaction_api.py:743: in test_split_transaction_maintains_balance
    transaction_id = create_response.json()["id"]
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'id'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:35,247", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:35,381", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: db442063-a9b4-42c7-a659-a7f4d34aff32 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:35,412", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=db442063-a9b4-42c7-a659-a7f4d34aff32, action=LOGIN, entity=user:db442063-a9b4-42c7-a659-a7f4d34aff32, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:35,415", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: db442063-a9b4-42c7-a659-a7f4d34aff32 (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:35,415", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.085s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:35,416", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:35,508", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=bf710001-806a-4654-acbf-88567757145a)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:35,509", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/901965f5-fec4-4b37-9def-007aa6fa4d02/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.025s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:35,509", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/901965f5-fec4-4b37-9def-007aa6fa4d02/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/901965f5-fec4-4b37-9def-007aa6fa4d02/transactions "HTTP/1.1 422 Unprocessable Entity"
_________________ test_cannot_split_already_split_transaction __________________
tests/integration/test_transaction_api.py:780: in test_cannot_split_already_split_transaction
    transaction_id = create_response.json()["id"]
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'id'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:35,605", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:35,750", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 030c372e-28d8-4f2b-8032-37b2360d9eac (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:35,782", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=030c372e-28d8-4f2b-8032-37b2360d9eac, action=LOGIN, entity=user:030c372e-28d8-4f2b-8032-37b2360d9eac, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:35,785", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 030c372e-28d8-4f2b-8032-37b2360d9eac (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:35,786", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.092s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:35,786", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:35,879", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=6dd11772-0dbd-42a9-bce7-d57962f9754b)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:35,880", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/34344961-3f95-4d3c-9925-c354a208f751/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.024s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:35,880", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/34344961-3f95-4d3c-9925-c354a208f751/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/34344961-3f95-4d3c-9925-c354a208f751/transactions "HTTP/1.1 422 Unprocessable Entity"
_____________ test_cannot_create_transaction_in_non_member_account _____________
tests/integration/test_transaction_api.py:845: in test_cannot_create_transaction_in_non_member_account
    account_type=AccountType.SAVINGS,
                 ^^^^^^^^^^^^^^^^^^^
E   AttributeError: type object 'AccountType' has no attribute 'SAVINGS'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:35,979", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
_________________ test_cannot_access_another_users_transaction _________________
tests/integration/test_transaction_api.py:917: in test_cannot_access_another_users_transaction
    transaction_id = create_response.json()["id"]
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'id'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:36,212", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:36,345", "name": "src.services.auth_service", "levelname": "INFO", "filename": "auth_service.py", "lineno": 202, "funcName": "login", "message": "User logged in successfully: 3bec6043-12a7-4df4-9716-5dd8dd7f8aee (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:36,378", "name": "src.services.audit_service", "levelname": "DEBUG", "filename": "audit_service.py", "lineno": 118, "funcName": "log_event", "message": "Audit log created: user=3bec6043-12a7-4df4-9716-5dd8dd7f8aee, action=LOGIN, entity=user:3bec6043-12a7-4df4-9716-5dd8dd7f8aee, status=SUCCESS", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:36,380", "name": "src.api.routes.auth", "levelname": "INFO", "filename": "auth.py", "lineno": 189, "funcName": "login", "message": "User logged in: 3bec6043-12a7-4df4-9716-5dd8dd7f8aee (testuser@example.com)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:36,381", "name": "src.middleware", "levelname": "INFO", "filename": "middleware.py", "lineno": 206, "funcName": "dispatch", "message": "POST /api/auth/login 200 - request_id=unknown client=127.0.0.1 duration=0.085s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:36,381", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/auth/login \"HTTP/1.1 200 OK\"", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/auth/login "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
{"asctime": "2025-11-26 10:09:36,471", "name": "src.main", "levelname": "WARNING", "filename": "main.py", "lineno": 160, "funcName": "validation_exception_handler", "message": "Validation error: [{'type': 'enum', 'loc': ('body', 'transaction_type'), 'msg': \"Input should be 'income', 'expense' or 'transfer'\", 'input': 'debit', 'ctx': {'expected': \"'income', 'expense' or 'transfer'\"}}] (request_id=ab32e79a-eac8-4999-9f81-5552f5b8a874)", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:36,471", "name": "src.middleware", "levelname": "WARNING", "filename": "middleware.py", "lineno": 208, "funcName": "dispatch", "message": "POST /api/v1/accounts/79b89c2d-4220-46ca-9875-e3236d85219d/transactions 422 - request_id=unknown client=127.0.0.1 duration=0.026s user_agent=python-httpx/0.28.1", "correlation_id": "no-request-id"}
{"asctime": "2025-11-26 10:09:36,472", "name": "httpx", "levelname": "INFO", "filename": "_client.py", "lineno": 1740, "funcName": "_send_single_request", "message": "HTTP Request: POST http://test/api/v1/accounts/79b89c2d-4220-46ca-9875-e3236d85219d/transactions \"HTTP/1.1 422 Unprocessable Entity\"", "correlation_id": "no-request-id"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/accounts/79b89c2d-4220-46ca-9875-e3236d85219d/transactions "HTTP/1.1 422 Unprocessable Entity"
__________________ TestAccountRepository.test_create_account ___________________
tests/unit/repositories/test_account_repository.py:33: in test_create_account
    account_type=AccountType.SAVINGS,
                 ^^^^^^^^^^^^^^^^^^^
E   AttributeError: type object 'AccountType' has no attribute 'SAVINGS'
---------------------------- Captured stdout setup -----------------------------
{"asctime": "2025-11-26 10:09:36,780", "name": "asyncio", "levelname": "DEBUG", "filename": "selector_events.py", "lineno": 64, "funcName": "__init__", "message": "Using selector: KqueueSelector", "correlation_id": "no-request-id"}
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
=============================== warnings summary ===============================
src/schemas/transaction.py:137
  /Users/danieltorres/Documents/emerald/emerald-backend/src/schemas/transaction.py:137: PydanticDeprecatedSince20: `max_items` is deprecated and will be removed, use `max_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    tags: list[str] | None = Field(

.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/e2e/test_collaboration_workflow.py: 3 warnings
tests/e2e/test_user_journey.py: 7 warnings
tests/integration/test_account_routes.py: 6 warnings
tests/integration/test_account_sharing_routes.py: 1 warning
tests/integration/test_auth_routes.py: 3 warnings
tests/integration/test_transaction_api.py: 22 warnings
  /Users/danieltorres/Documents/emerald/emerald-backend/.venv/lib/python3.13/site-packages/starlette/_exception_handler.py:59: DeprecationWarning: 'HTTP_422_UNPROCESSABLE_ENTITY' is deprecated. Use 'HTTP_422_UNPROCESSABLE_CONTENT' instead.
    response = await handler(conn, exc)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/e2e/test_collaboration_workflow.py::test_account_sharing_collaboration_workflow
FAILED tests/e2e/test_collaboration_workflow.py::test_permission_downgrade_workflow
FAILED tests/e2e/test_collaboration_workflow.py::test_shared_account_transaction_visibility
FAILED tests/e2e/test_collaboration_workflow.py::test_share_list_visibility
FAILED tests/e2e/test_collaboration_workflow.py::test_cascading_share_revocation
FAILED tests/e2e/test_user_journey.py::test_complete_user_journey - assert 42...
FAILED tests/e2e/test_user_journey.py::test_new_user_creates_multiple_accounts_and_transactions
FAILED tests/e2e/test_user_journey.py::test_transaction_tag_management_workflow
FAILED tests/e2e/test_user_journey.py::test_transaction_split_and_join_workflow
FAILED tests/integration/test_account_routes.py::TestAccountRoutes::test_create_account_negative_balance
FAILED tests/integration/test_account_routes.py::TestAccountRoutes::test_list_accounts_pagination
FAILED tests/integration/test_account_sharing_routes.py::test_create_share_viewer_success
FAILED tests/integration/test_account_sharing_routes.py::test_create_share_editor_success
FAILED tests/integration/test_account_sharing_routes.py::test_create_share_cannot_grant_owner_permission
FAILED tests/integration/test_account_sharing_routes.py::test_create_share_non_owner_cannot_share
FAILED tests/integration/test_account_sharing_routes.py::test_create_share_cannot_share_with_self
FAILED tests/integration/test_account_sharing_routes.py::test_create_share_nonexistent_account
FAILED tests/integration/test_account_sharing_routes.py::test_create_share_nonexistent_user
FAILED tests/integration/test_account_sharing_routes.py::test_create_share_duplicate_share
FAILED tests/integration/test_account_sharing_routes.py::test_list_shares_owner_sees_all
FAILED tests/integration/test_account_sharing_routes.py::test_list_shares_editor_can_view
FAILED tests/integration/test_account_sharing_routes.py::test_list_shares_viewer_can_view
FAILED tests/integration/test_account_sharing_routes.py::test_list_shares_non_member_cannot_view
FAILED tests/integration/test_account_sharing_routes.py::test_list_shares_empty_for_unshared_account
FAILED tests/integration/test_account_sharing_routes.py::test_update_share_upgrade_viewer_to_editor
FAILED tests/integration/test_account_sharing_routes.py::test_update_share_downgrade_editor_to_viewer
FAILED tests/integration/test_account_sharing_routes.py::test_update_share_cannot_grant_owner_permission
FAILED tests/integration/test_account_sharing_routes.py::test_update_share_non_owner_cannot_update
FAILED tests/integration/test_account_sharing_routes.py::test_update_share_nonexistent_share
FAILED tests/integration/test_account_sharing_routes.py::test_update_share_cannot_modify_owner_share
FAILED tests/integration/test_account_sharing_routes.py::test_revoke_share_viewer_success
FAILED tests/integration/test_account_sharing_routes.py::test_revoke_share_editor_success
FAILED tests/integration/test_account_sharing_routes.py::test_revoke_share_non_owner_cannot_revoke
FAILED tests/integration/test_account_sharing_routes.py::test_revoke_share_cannot_revoke_owner_share
FAILED tests/integration/test_account_sharing_routes.py::test_revoke_share_user_loses_access_immediately
FAILED tests/integration/test_auth_routes.py::TestPasswordChange::test_change_password_success
FAILED tests/integration/test_transaction_api.py::TestTransactionAPI::test_create_transaction
FAILED tests/integration/test_transaction_api.py::TestTransactionAPI::test_list_transactions
FAILED tests/integration/test_transaction_api.py::TestTransactionAPI::test_get_transaction
FAILED tests/integration/test_transaction_api.py::TestTransactionAPI::test_update_transaction
FAILED tests/integration/test_transaction_api.py::TestTransactionAPI::test_delete_transaction
FAILED tests/integration/test_transaction_api.py::TestTransactionAPI::test_split_transaction
FAILED tests/integration/test_transaction_api.py::TestTransactionAPI::test_join_split_transaction
FAILED tests/integration/test_transaction_api.py::TestTransactionAPI::test_add_tag
FAILED tests/integration/test_transaction_api.py::TestTransactionAPI::test_remove_tag
FAILED tests/integration/test_transaction_api.py::TestTransactionAPI::test_permission_denied
FAILED tests/integration/test_transaction_api.py::test_viewer_cannot_create_transaction
FAILED tests/integration/test_transaction_api.py::test_viewer_cannot_update_transaction
FAILED tests/integration/test_transaction_api.py::test_viewer_cannot_delete_transaction
FAILED tests/integration/test_transaction_api.py::test_editor_can_create_transaction
FAILED tests/integration/test_transaction_api.py::test_owner_has_full_access
FAILED tests/integration/test_transaction_api.py::test_cannot_create_transaction_with_wrong_currency
FAILED tests/integration/test_transaction_api.py::test_split_transaction_maintains_balance
FAILED tests/integration/test_transaction_api.py::test_cannot_split_already_split_transaction
FAILED tests/integration/test_transaction_api.py::test_cannot_create_transaction_in_non_member_account
FAILED tests/integration/test_transaction_api.py::test_cannot_access_another_users_transaction
FAILED tests/unit/repositories/test_account_repository.py::TestAccountRepository::test_create_account
ERROR tests/unit/repositories/test_account_repository.py::TestAccountRepository::test_get_by_id
ERROR tests/unit/repositories/test_account_repository.py::TestAccountRepository::test_get_by_user
ERROR tests/unit/repositories/test_account_repository.py::TestAccountRepository::test_get_by_user_with_filters
ERROR tests/unit/repositories/test_account_repository.py::TestAccountRepository::test_get_by_user_pagination
ERROR tests/unit/repositories/test_account_repository.py::TestAccountRepository::test_get_by_name
ERROR tests/unit/repositories/test_account_repository.py::TestAccountRepository::test_exists_by_name
ERROR tests/unit/repositories/test_account_repository.py::TestAccountRepository::test_exists_by_name_with_exclude
ERROR tests/unit/repositories/test_account_repository.py::TestAccountRepository::test_count_user_accounts
ERROR tests/unit/repositories/test_account_repository.py::TestAccountRepository::test_soft_delete_filtering
ERROR tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_create_transaction
ERROR tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_get_by_id
ERROR tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_get_by_account_id
ERROR tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_count_by_account_id
ERROR tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_search_by_date_range
ERROR tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_search_by_amount_range
ERROR tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_search_by_type
ERROR tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_get_children
ERROR tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_has_children
ERROR tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_calculate_account_balance
ERROR tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_get_balance_at_date
ERROR tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_soft_delete_filtering
ERROR tests/unit/repositories/test_transaction_repository.py::TestTransactionRepository::test_pagination
ERROR tests/unit/repositories/test_transaction_tag_repository.py::TestTransactionTagRepository::test_add_tag
ERROR tests/unit/repositories/test_transaction_tag_repository.py::TestTransactionTagRepository::test_tag_normalization
ERROR tests/unit/repositories/test_transaction_tag_repository.py::TestTransactionTagRepository::test_remove_tag
ERROR tests/unit/repositories/test_transaction_tag_repository.py::TestTransactionTagRepository::test_remove_nonexistent_tag
ERROR tests/unit/repositories/test_transaction_tag_repository.py::TestTransactionTagRepository::test_get_tags
ERROR tests/unit/repositories/test_transaction_tag_repository.py::TestTransactionTagRepository::test_get_all_tags_for_account
ERROR tests/unit/repositories/test_transaction_tag_repository.py::TestTransactionTagRepository::test_get_tag_usage_counts
ERROR tests/unit/repositories/test_transaction_tag_repository.py::TestTransactionTagRepository::test_exists
ERROR tests/unit/repositories/test_transaction_tag_repository.py::TestTransactionTagRepository::test_duplicate_tag_prevention
ERROR tests/unit/repositories/test_transaction_tag_repository.py::TestTransactionTagRepository::test_tags_sorted_alphabetically
ERROR tests/unit/services/test_account_service.py::TestAccountService::test_create_account_success
ERROR tests/unit/services/test_account_service.py::TestAccountService::test_create_account_duplicate_name
ERROR tests/unit/services/test_account_service.py::TestAccountService::test_create_account_invalid_currency
ERROR tests/unit/services/test_account_service.py::TestAccountService::test_create_account_negative_balance
ERROR tests/unit/services/test_account_service.py::TestAccountService::test_get_account_success
ERROR tests/unit/services/test_account_service.py::TestAccountService::test_get_account_not_owner
ERROR tests/unit/services/test_account_service.py::TestAccountService::test_get_account_not_found
ERROR tests/unit/services/test_account_service.py::TestAccountService::test_list_accounts
ERROR tests/unit/services/test_account_service.py::TestAccountService::test_list_accounts_with_filters
ERROR tests/unit/services/test_account_service.py::TestAccountService::test_list_accounts_pagination
ERROR tests/unit/services/test_account_service.py::TestAccountService::test_list_accounts_limit_enforced
ERROR tests/unit/services/test_account_service.py::TestAccountService::test_update_account_name
ERROR tests/unit/services/test_account_service.py::TestAccountService::test_update_account_is_active
ERROR tests/unit/services/test_account_service.py::TestAccountService::test_update_account_duplicate_name
ERROR tests/unit/services/test_account_service.py::TestAccountService::test_update_account_no_changes
ERROR tests/unit/services/test_account_service.py::TestAccountService::test_delete_account
ERROR tests/unit/services/test_account_service.py::TestAccountService::test_delete_account_not_owner
ERROR tests/unit/services/test_account_service.py::TestAccountService::test_count_user_accounts
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceCreate::test_create_transaction_success
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceCreate::test_create_transaction_updates_balance
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceCreate::test_create_transaction_currency_mismatch
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceCreate::test_create_transaction_zero_amount
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceCreate::test_create_transaction_permission_denied
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceRead::test_get_transaction_success
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceRead::test_get_transaction_not_found
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceRead::test_get_transaction_permission_denied
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceRead::test_search_transactions
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceUpdate::test_update_transaction_success
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceUpdate::test_update_transaction_balance_delta
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceUpdate::test_update_transaction_zero_amount
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceUpdate::test_update_transaction_permission_denied
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceDelete::test_delete_transaction_success
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceDelete::test_delete_transaction_updates_balance
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceDelete::test_delete_parent_deletes_children
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceSplit::test_split_transaction_success
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceSplit::test_split_transaction_amounts_must_sum
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceSplit::test_split_requires_minimum_two_splits
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceSplit::test_cannot_split_child_transaction
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceSplit::test_join_split_transaction
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceSplit::test_join_requires_splits
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceTags::test_add_tag_success
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceTags::test_remove_tag_success
ERROR tests/unit/services/test_transaction_service.py::TestTransactionServiceTags::test_tag_permission_denied
====== 57 failed, 202 passed, 44 warnings, 75 errors in 75.46s (0:01:15) =======
